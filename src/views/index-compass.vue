<template>
  <div class="page-wrapper">
    <div class="main-container">
      <!-- 1. é¡µé¢æ ‡é¢˜ -->
      <div class="page-header">
        <router-link to="/home" class="back-button"> â† è¿”å›ä¸»é¡µ </router-link>

        <h1 class="main-title">
          <span class="title-icon">ğŸ“Š</span>
          æŒ‡æ•°ç½—ç›˜
        </h1>
        <p class="subtitle">ä¸€è§ˆä¼—å±±å°ï¼Œè½»æ¾æŒæ¡å…¨å¸‚åœºæŒ‡æ•°åŠ¨æ€ã€‚</p>
      </div>

      <!-- 2. æŒ‡æ•°æ•°æ®è¡¨æ ¼ -->
      <div class="table-container">
        <table>
          <thead>
            <tr>
              <!-- è¡¨å¤´ï¼Œç‚¹å‡»å¯æ’åº -->
              <th @click="handleSort('name')">
                æŒ‡æ•°
                <span v-if="sortKey === 'name'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('category')">
                æŒ‡æ•°åˆ†ç±»
                <span v-if="sortKey === 'category'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('latestPrice')">
                æœ€æ–°ä»·
                <span v-if="sortKey === 'latestPrice'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('changePercent')">
                æ¶¨è·Œå¹…
                <span v-if="sortKey === 'changePercent'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('prevChangePercent')">
                ä¸Šæ—¥æ¶¨è·Œ
                <span v-if="sortKey === 'prevChangePercent'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('weekChange')">
                è¿‘ä¸€å‘¨
                <span v-if="sortKey === 'weekChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('monthChange')">
                è¿‘ä¸€æœˆ
                <span v-if="sortKey === 'monthChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('threeMonthChange')">
                è¿‘3æœˆ
                <span v-if="sortKey === 'threeMonthChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('ytdChange')">
                å¹´åˆè‡³ä»Š
                <span v-if="sortKey === 'ytdChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('yearChange')">
                è¿‘ä¸€å¹´
                <span v-if="sortKey === 'yearChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('threeYearChange')">
                è¿‘3å¹´
                <span v-if="sortKey === 'threeYearChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('fiveYearChange')">
                è¿‘5å¹´
                <span v-if="sortKey === 'fiveYearChange'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('roe')">
                ROE
                <span v-if="sortKey === 'roe'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('revenueGrowth')">
                è¥æ”¶å¢é€Ÿ
                <span v-if="sortKey === 'revenueGrowth'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('profitGrowth')">
                å‡€åˆ©å¢é€Ÿ
                <span v-if="sortKey === 'profitGrowth'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('dividendYield')">
                è‚¡æ¯ç‡
                <span v-if="sortKey === 'dividendYield'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('pe')">
                PE-TTM
                <span v-if="sortKey === 'pe'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('pePercentile')">
                PEç™¾åˆ†ä½
                <span v-if="sortKey === 'pePercentile'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('pb')">
                PB
                <span v-if="sortKey === 'pb'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('pbPercentile')">
                PBç™¾åˆ†ä½
                <span v-if="sortKey === 'pbPercentile'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('ps')">
                PS-TTM
                <span v-if="sortKey === 'ps'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
              <th @click="handleSort('psPercentile')">
                PSç™¾åˆ†ä½
                <span v-if="sortKey === 'psPercentile'" class="sort-indicator">{{
                  sortOrder === 'asc' ? 'â–²' : 'â–¼'
                }}</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr v-for="item in sortedData" :key="item.id">
              <td>{{ item.name }}</td>
              <td>{{ item.category }}</td>
              <td>{{ item.latestPrice.toFixed(2) }}</td>
              <td :class="getColorForChange(item.changePercent)">
                {{ formatPercentage(item.changePercent) }}
              </td>
              <td :class="getColorForChange(item.prevChangePercent)">
                {{ formatPercentage(item.prevChangePercent) }}
              </td>
              <td :class="getColorForChange(item.weekChange)">
                {{ formatPercentage(item.weekChange) }}
              </td>
              <td :class="getColorForChange(item.monthChange)">
                {{ formatPercentage(item.monthChange) }}
              </td>
              <td :class="getColorForChange(item.threeMonthChange)">
                {{ formatPercentage(item.threeMonthChange) }}
              </td>
              <td :class="getColorForChange(item.ytdChange)">
                {{ formatPercentage(item.ytdChange) }}
              </td>
              <td :class="getColorForChange(item.yearChange)">
                {{ formatPercentage(item.yearChange) }}
              </td>
              <td :class="getColorForChange(item.threeYearChange)">
                {{ formatPercentage(item.threeYearChange) }}
              </td>
              <td :class="getColorForChange(item.fiveYearChange)">
                {{ formatPercentage(item.fiveYearChange) }}
              </td>
              <td>{{ formatPercentage(item.roe) }}</td>
              <td>{{ formatPercentage(item.revenueGrowth) }}</td>
              <td>{{ formatPercentage(item.profitGrowth) }}</td>
              <td>{{ formatPercentage(item.dividendYield) }}</td>
              <td>{{ item.pe.toFixed(2) }}</td>
              <td>{{ formatPercentage(item.pePercentile) }}</td>
              <td>{{ item.pb.toFixed(2) }}</td>
              <td>{{ formatPercentage(item.pbPercentile) }}</td>
              <td>{{ item.ps.toFixed(2) }}</td>
              <td>{{ formatPercentage(item.psPercentile) }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
  import { ref, computed } from 'vue'

  // å®šä¹‰æŒ‡æ•°æ•°æ®çš„æ¥å£/ç±»å‹
  interface IndexData {
      id: number
      name: string
      category: string
      latestPrice: number
      changePercent: number
      prevChangePercent: number
      weekChange: number
      monthChange: number
      threeMonthChange: number
      ytdChange: number
      yearChange: number
      threeYearChange: number
      fiveYearChange: number
      roe: number
      revenueGrowth: number
      profitGrowth: number
      dividendYield: number
      pe: number
      pePercentile: number
      pb: number
      pbPercentile: number
      ps: number
      psPercentile: number
  }

  // --- çŠ¶æ€ç®¡ç† ---
  const sortKey = ref<keyof IndexData | null>('changePercent') // é»˜è®¤æŒ‰æ¶¨è·Œå¹…æ’åº
  const sortOrder = ref<'asc' | 'desc'>('desc') // é»˜è®¤é™åº

  // --- æ¨¡æ‹Ÿæ•°æ® (æœªæ¥å¯æ›¿æ¢ä¸ºAPIè·å–) ---
  const indexData = ref<IndexData[]>([
      {
          id: 1,
          name: 'æ²ªæ·±300',
          category: 'å¤§ç›˜',
          latestPrice: 3540.88,
          changePercent: 0.55,
          prevChangePercent: -0.21,
          weekChange: 1.2,
          monthChange: 3.5,
          threeMonthChange: 5.1,
          ytdChange: 2.8,
          yearChange: -8.5,
          threeYearChange: -25.0,
          fiveYearChange: 15.2,
          roe: 11.5,
          revenueGrowth: 5.2,
          profitGrowth: 4.8,
          dividendYield: 2.8,
          pe: 11.8,
          pePercentile: 25.5,
          pb: 1.3,
          pbPercentile: 10.2,
          ps: 1.1,
          psPercentile: 30.1
      },
      {
          id: 2,
          name: 'ä¸­è¯500',
          category: 'ä¸­ç›˜',
          latestPrice: 5380.15,
          changePercent: -0.12,
          prevChangePercent: 0.5,
          weekChange: -0.5,
          monthChange: 2.1,
          threeMonthChange: 8.2,
          ytdChange: 4.5,
          yearChange: -12.3,
          threeYearChange: -18.7,
          fiveYearChange: 22.8,
          roe: 9.8,
          revenueGrowth: 8.1,
          profitGrowth: 7.5,
          dividendYield: 1.9,
          pe: 22.5,
          pePercentile: 15.8,
          pb: 1.7,
          pbPercentile: 8.5,
          ps: 1.5,
          psPercentile: 22.4
      },
      {
          id: 3,
          name: 'åˆ›ä¸šæ¿æŒ‡',
          category: 'æˆé•¿',
          latestPrice: 1805.4,
          changePercent: -1.08,
          prevChangePercent: -0.8,
          weekChange: -2.5,
          monthChange: -1.8,
          threeMonthChange: 4.6,
          ytdChange: -3.7,
          yearChange: -20.1,
          threeYearChange: -45.6,
          fiveYearChange: 35.1,
          roe: 8.5,
          revenueGrowth: 12.3,
          profitGrowth: 10.2,
          dividendYield: 0.9,
          pe: 28.9,
          pePercentile: 5.2,
          pb: 3.5,
          pbPercentile: 12.1,
          ps: 2.8,
          psPercentile: 18.9
      },
      {
          id: 4,
          name: 'ä¸­è¯ç™½é…’',
          category: 'æ¶ˆè´¹',
          latestPrice: 13580.7,
          changePercent: 1.25,
          prevChangePercent: 0.3,
          weekChange: 3.1,
          monthChange: 8.9,
          threeMonthChange: 2.3,
          ytdChange: -5.6,
          yearChange: -15.8,
          threeYearChange: -33.1,
          fiveYearChange: 88.9,
          roe: 28.5,
          revenueGrowth: 15.8,
          profitGrowth: 18.2,
          dividendYield: 1.5,
          pe: 25.1,
          pePercentile: 45.3,
          pb: 5.8,
          pbPercentile: 38.6,
          ps: 6.5,
          psPercentile: 55.2
      },
      {
          id: 5,
          name: 'åŠå¯¼ä½“',
          category: 'ç§‘æŠ€',
          latestPrice: 6500.5,
          changePercent: 2.8,
          prevChangePercent: -1.5,
          weekChange: 5.5,
          monthChange: -3.2,
          threeMonthChange: 15.8,
          ytdChange: 12.1,
          yearChange: -5.3,
          threeYearChange: -40.2,
          fiveYearChange: 150.3,
          roe: 5.2,
          revenueGrowth: 18.5,
          profitGrowth: -2.5,
          dividendYield: 0.5,
          pe: 55.8,
          pePercentile: 70.8,
          pb: 4.1,
          pbPercentile: 65.4,
          ps: 4.5,
          psPercentile: 75.1
      },
      {
          id: 6,
          name: 'ä¸­è¯é“¶è¡Œ',
          category: 'é‡‘è',
          latestPrice: 7200.3,
          changePercent: 0.15,
          prevChangePercent: 0.1,
          weekChange: 0.8,
          monthChange: 4.5,
          threeMonthChange: 10.2,
          ytdChange: 15.3,
          yearChange: 20.5,
          threeYearChange: 5.1,
          fiveYearChange: 25.8,
          roe: 10.1,
          revenueGrowth: 2.1,
          profitGrowth: 3.5,
          dividendYield: 5.5,
          pe: 5.2,
          pePercentile: 2.1,
          pb: 0.5,
          pbPercentile: 1.5,
          ps: 1.2,
          psPercentile: 3.2
      }
  ])

  // --- è®¡ç®—å±æ€§ ---
  /**
   * æ ¹æ® sortKey å’Œ sortOrder å¯¹æ•°æ®è¿›è¡Œæ’åº
   */
  const sortedData = computed(() => {
      if (!sortKey.value) {
          return indexData.value
      }
      const key = sortKey.value
      return [...indexData.value].sort((a, b) => {
          const valA = a[key]
          const valB = b[key]

          if (typeof valA === 'number' && typeof valB === 'number') {
              return sortOrder.value === 'asc' ? valA - valB : valB - valA
          }

          // å­—ç¬¦ä¸²æˆ–å…¶ä»–ç±»å‹æ’åº
          if (String(valA) < String(valB)) return sortOrder.value === 'asc' ? -1 : 1
          if (String(valA) > String(valB)) return sortOrder.value === 'asc' ? 1 : -1
          return 0
      })
  })

  // --- æ–¹æ³• ---
  /**
   * å¤„ç†è¡¨å¤´ç‚¹å‡»äº‹ä»¶ï¼Œæ›´æ–°æ’åºçŠ¶æ€
   * @param key ç‚¹å‡»çš„åˆ—å
   */
  const handleSort = (key: keyof IndexData) => {
      if (sortKey.value === key) {
          // å¦‚æœç‚¹å‡»çš„æ˜¯å½“å‰æ’åºåˆ—ï¼Œåˆ™åˆ‡æ¢æ’åºé¡ºåº
          sortOrder.value = sortOrder.value === 'asc' ? 'desc' : 'asc'
      } else {
          // å¦‚æœç‚¹å‡»çš„æ˜¯æ–°åˆ—ï¼Œåˆ™è®¾ç½®æ–°åˆ—ä¸ºæ’åºåˆ—ï¼Œå¹¶é‡ç½®ä¸ºé™åº
          sortKey.value = key
          sortOrder.value = 'desc'
      }
  }

  /**
   * æ ¼å¼åŒ–ç™¾åˆ†æ¯”æ˜¾ç¤º
   * @param value æ•°å€¼
   */
  const formatPercentage = (value: number): string => {
      if (value == null) return '-'
      const sign = value > 0 ? '+' : ''
      return `${sign}${value.toFixed(2)}%`
  }

  /**
   * æ ¹æ®æ•°å€¼æ­£è´Ÿè¿”å›å¯¹åº”çš„CSSç±»
   * @param value æ•°å€¼
   */
  const getColorForChange = (value: number): string => {
      if (value > 0) return 'positive'
      if (value < 0) return 'negative'
      return ''
  }
</script>

<style scoped>
  /* åŸºç¡€é¡µé¢æ ·å¼ï¼Œå¤§éƒ¨åˆ†å¤ç”¨åŸæœ‰é£æ ¼ */
  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(20px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  .page-wrapper {
      font-family: 'Noto Sans SC', sans-serif;
      background-color: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 3rem 1rem;
      background: radial-gradient(circle at 15% 50%, #1a4a4a, transparent 40%),
          radial-gradient(circle at 85% 50%, #1f6666, transparent 40%), #121212;
  }

  .main-container {
      max-width: 95%; /* å…è®¸æ›´å®½çš„å¸ƒå±€ä»¥å®¹çº³è¡¨æ ¼ */
      margin: 0 auto;
  }

  .page-header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.5s ease-out forwards;
      opacity: 0;
  }

  .back-button {
      color: #b0c4de;
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.3s ease;
      display: inline-block;
      margin-bottom: 1rem;
  }
  .back-button:hover {
      color: #00aaff;
  }

  .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
  }
  .title-icon {
      font-size: 2.8rem;
      text-shadow: 0 0 15px rgba(57, 204, 204, 0.7);
  }
  .subtitle {
      font-size: 1.1rem;
      color: #b0c4de;
  }

  /* --- æ–°å¢ï¼šè¡¨æ ¼å®¹å™¨å’Œè¡¨æ ¼æ ·å¼ --- */
  .table-container {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem;
      backdrop-filter: blur(10px);
      animation: fadeInUp 0.5s ease-out 0.2s forwards;
      opacity: 0;
      overflow-x: auto; /* å…³é”®ï¼šå½“è¡¨æ ¼è¿‡å®½æ—¶ï¼Œå…è®¸æ°´å¹³æ»šåŠ¨ */
  }

  table {
      width: 100%;
      border-collapse: collapse;
      min-width: 1800px; /* è®¾ç½®ä¸€ä¸ªæœ€å°å®½åº¦ä»¥ç¡®ä¿åœ¨å®½å±ä¸‹ä¹Ÿèƒ½æ­£å¸¸æ˜¾ç¤º */
      white-space: nowrap; /* é˜²æ­¢å•å…ƒæ ¼å†…å®¹æ¢è¡Œ */
  }

  th,
  td {
      padding: 12px 15px;
      text-align: right; /* æ•°æ®åˆ—å³å¯¹é½ï¼Œæ›´æ˜“äºæ¯”è¾ƒ */
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  th:first-child,
  td:first-child,
  th:nth-child(2),
  td:nth-child(2) {
      text-align: left; /* æŒ‡æ•°åç§°å’Œåˆ†ç±»å·¦å¯¹é½ */
  }

  thead th {
      background-color: rgba(57, 204, 204, 0.1);
      font-weight: 600;
      color: #e0e0e0;
      cursor: pointer;
      transition: background-color 0.3s ease;
      position: sticky; /* è¡¨å¤´å¸é¡¶ */
      top: 0;
      z-index: 1;
  }

  thead th:hover {
      background-color: rgba(57, 204, 204, 0.2);
  }

  .sort-indicator {
      margin-left: 5px;
      color: #39cccc;
  }

  tbody tr {
      transition: background-color 0.3s ease;
  }

  tbody tr:hover {
      background-color: rgba(255, 255, 255, 0.08);
  }

  td {
      color: #c0c0c0;
  }

  .positive {
      color: #ff6b6b; /* çº¢æ¶¨ */
  }

  .negative {
      color: #28a745; /* ç»¿è·Œ */
  }

  /* å“åº”å¼è®¾è®¡ */
  @media (max-width: 768px) {
      .page-wrapper {
          padding: 2rem 0.5rem;
      }
      .main-title {
          font-size: 2rem;
      }
      .table-container {
          padding: 1rem;
      }
      th,
      td {
          padding: 10px 8px;
          font-size: 0.9rem;
      }
  }
</style>