<template>
  <div class="page-wrapper">
    <div class="main-container">

      <!-- 1. é¡µé¢æ ‡é¢˜ -->
      <div class="page-header">
        <router-link to="/home" class="back-button">
          â† è¿”å›ä¸»é¡µ
        </router-link>
        <h1 class="main-title">
          <span class="title-icon cash-flow">ğŸ’°</span>
          ç°é‡‘æµç­–ç•¥
        </h1>
        <p class="subtitle">
          ä¸“æ³¨äºæ„å»ºèƒ½å¤ŸæŒç»­äº§ç”Ÿè¢«åŠ¨æ”¶å…¥çš„èµ„äº§ç»„åˆã€‚
        </p>
      </div>

      <!-- 2. å†…å®¹å¡ç‰‡åŒºåŸŸ -->
      <div class="content-grid">

        <!-- å¡ç‰‡1: ç­–ç•¥ç®€ä»‹ -->
        <div class="content-card">
          <h2 class="card-title">ç­–ç•¥ç®€ä»‹</h2>
          <p class="card-description">
            å¦‚æœè¯´æŠ•èµ„çš„ç¬¬ä¸€æ€§åŸç†æ˜¯<strong>ç®¡ç†é£é™©</strong>ï¼Œé‚£ä¹ˆç†è´¢çš„ç¬¬ä¸€æ€§åŸç†å°±æ˜¯<strong>åˆ›é€ ç°é‡‘æµ</strong>ã€‚<br><br>
            ç°é‡‘æµçš„æ„ä¹‰è¿œä¸æ­¢äºè´¦é¢æ•°å­—ï¼Œå®ƒæ›´æ˜¯ä¸€ç§å¼ºå¤§çš„å¿ƒç†â€œå‹èˆ±çŸ³â€ã€‚åœ¨å¸‚åœºåŠ¨è¡ã€äººå¿ƒæƒ¶æƒ¶çš„ç†Šå¸‚ä¸­ï¼Œä¸€ä»½ç¨³å®šåˆ°è´¦çš„è‚¡æ¯æ”¶å…¥ï¼Œæ˜¯èƒ½è®©ä½ ç©¿è¶Šå‘¨æœŸã€å®‰å¿ƒæŒæœ‰çš„åº•æ°”ä¸ä¿¡å¿ƒã€‚å½“æ³¢åŠ¨æˆä¸ºå¸¸æ€ï¼Œå¯é¢„æµ‹çš„ç°é‡‘æµå°±æ˜¯å¯¹æŠ—ä¸ç¡®å®šæ€§çš„æœ€ä½³æ­¦å™¨ã€‚<br><br>
            æœ¬ç­–ç•¥çš„æ ¸å¿ƒç›®æ ‡ï¼Œæ­£æ˜¯å›´ç»•è¿™ä¸€åŸç†æ„å»ºã€‚æˆ‘ä»¬é€šè¿‡æŠ•èµ„ä¸€ç³»åˆ—èƒ½å¤Ÿç¨³å®šæ´¾å‘è‚¡æ¯ã€åˆ©æ¯çš„ä¼˜è´¨èµ„äº§ï¼Œä¸ºæ‚¨æ‰“é€ ä¸€å°æŒç»­è¿è½¬çš„â€œèµ„äº§å°é’æœºâ€ã€‚æˆ‘ä»¬è¿½æ±‚çš„å¹¶éçŸ­æœŸä»·æ ¼çš„æš´æ¶¨ï¼Œè€Œæ˜¯æ”¶å…¥çš„é•¿æœŸå¯æŒç»­æ€§ä¸å¤åˆ©å¢é•¿ã€‚æœ€ç»ˆï¼Œè¿™ä»½è¢«åŠ¨æ”¶å…¥å°†æˆä¸ºæ‚¨è´¢åŠ¡è§„åˆ’ä¸­çš„åšå›ºåŸºçŸ³ï¼Œæ— è®ºé£äº‘å¦‚ä½•å˜å¹»ï¼Œéƒ½èƒ½ä¸ºæ‚¨æä¾›ä¸€ä»½ä»å®¹ä¸ç¬ƒå®šã€‚
          </p>
        </div>

        <!-- å¡ç‰‡2: æ ¸å¿ƒæŠ•èµ„åŸåˆ™ -->
        <div class="content-card">
          <h2 class="card-title">æ ¸å¿ƒæŠ•èµ„åŸåˆ™</h2>
          <p class="card-description">
            æ„å»ºç¨³å®šç°é‡‘æµç»„åˆï¼Œå¦‚åŒç­›é€‰èƒ½æŒç»­äº§å¥¶çš„â€œç°é‡‘å¥¶ç‰›â€ã€‚æˆ‘ä»¬çš„é€‰è‚¡é€»è¾‘å¹¶éè¿½é€å¸‚åœºçƒ­ç‚¹ï¼Œè€Œæ˜¯ä¸¥æ ¼éµå¾ªä»¥ä¸‹å‡ æ¡ç»è¿‡æ—¶é—´æ£€éªŒçš„æ ¸å¿ƒåŸåˆ™ï¼š
          </p>
          <ul class="idea-list">
            <li>
              <b>ç›ˆåˆ©èƒ½åŠ›ï¼šé«˜ä¸”ç¨³å®šçš„ROE</b>
              æˆ‘ä»¬å¯»æ‰¾çš„ä¸æ˜¯æ˜™èŠ±ä¸€ç°çš„æ˜æ˜Ÿï¼Œè€Œæ˜¯æ‹¥æœ‰å®½é˜”â€œæŠ¤åŸæ²³â€ã€èƒ½é•¿æœŸç»´æŒé«˜ç›ˆåˆ©æ°´å¹³çš„ä¼˜è´¨ä¼ä¸šã€‚ä¸€ä¸ªæŒç»­ç¨³å®šåœ¨15%ä»¥ä¸Šçš„ROEï¼Œæ˜¯å…¬å¸å•†ä¸šæ¨¡å¼ä¼˜ç§€ã€ç®¡ç†å±‚å“è¶Šçš„ç›´æ¥ä½“ç°ï¼Œä¹Ÿæ˜¯æœªæ¥èƒ½å¤ŸæŒç»­æ´¾å‘è‚¡æ¯çš„æ ¹æœ¬ä¿éšœã€‚
            </li>
            <li>
              <b>å®‰å…¨è¾¹é™…ï¼šå¯è§‚çš„è‚¡æ¯ä¸åˆç†çš„ä¼°å€¼</b>
              æˆ‘ä»¬åšæŒâ€œå¥½å…¬å¸ä¹Ÿè¦æœ‰å¥½ä»·æ ¼â€ã€‚ä¸€æ–¹é¢ï¼Œè¾ƒé«˜çš„è‚¡æ¯ç‡ç›´æ¥æ„æˆäº†æˆ‘ä»¬çš„ç°é‡‘æµæ¥æºï¼›å¦ä¸€æ–¹é¢ï¼Œåˆç†çš„ç”šè‡³æ˜¯ä½ä¼°çš„ä¹°å…¥ä»·æ ¼ï¼Œä¸ºæˆ‘ä»¬çš„æœ¬é‡‘æä¾›äº†å¼ºå¤§çš„å®‰å…¨å«ï¼Œå¹¶é¢„ç•™äº†æœªæ¥ä»·å€¼å›å½’çš„ä¸Šæ¶¨ç©ºé—´ã€‚äºŒè€…ç»“åˆï¼Œæ„æˆäº†æ”»å®ˆå…¼å¤‡çš„æ ¸å¿ƒã€‚
            </li>
            <li>
              <b>èƒ½åŠ›åœˆåŸåˆ™ï¼šåªæŠ•èµ„çœ‹å¾—æ‡‚çš„ç”Ÿæ„</b>
              æˆ‘ä»¬åšä¿¡ï¼Œæœ€å¤§çš„é£é™©æ¥è‡ªäºæœªçŸ¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªæŠ•èµ„é‚£äº›å•†ä¸šæ¨¡å¼æ¸…æ™°ã€ä¸šåŠ¡é€»è¾‘ç®€å•ã€æˆ‘ä»¬èƒ½å¤Ÿç†è§£å¹¶èƒ½å¤§è‡´åˆ¤æ–­å…¶æœªæ¥å‡ å¹´å‘å±•å‰æ™¯çš„å…¬å¸ã€‚è¿™èƒ½å¸®åŠ©æˆ‘ä»¬æœ‰æ•ˆé¿å¼€è´¢åŠ¡å¤æ‚ã€å‰æ™¯ä¸æ˜çš„â€œä»·å€¼é™·é˜±â€ã€‚
            </li>
          </ul>
        </div>

        <!-- ==================== å¡ç‰‡3: æˆ‘çš„æŒä»“å‚è€ƒ (å…¨æ–°å¯å±•å¼€è®¾è®¡) ==================== -->
        <div class="content-card">
          <div class="card-header-with-admin">
            <h2 class="card-title no-border">æˆ‘çš„æŒä»“å‚è€ƒ</h2>
            <div v-if="isAdmin" class="admin-controls">
              <button v-if="!isHoldingsEditing" @click="editHoldings" class="edit-button">ç¼–è¾‘</button>
            </div>
          </div>
          <div class="disclaimer-box">
            <p><strong>é‡è¦æç¤ºï¼š</strong>ä»¥ä¸‹æŒä»“åˆ—è¡¨ä»…ä¸ºæˆ‘ä¸ªäººåŸºäºæœ¬ç­–ç•¥çš„å®è·µè®°å½•ï¼Œç”¨äºå­¦ä¹ å’Œå‚è€ƒï¼Œ<strong>ç»ä¸æ„æˆä»»ä½•æŠ•èµ„å»ºè®®</strong>ã€‚å¸‚åœºåœ¨å˜ï¼Œæˆ‘çš„æŒä»“ä¹Ÿä¼šåŠ¨æ€è°ƒæ•´ã€‚è¯·åŠ¡å¿…åŸºäºæ‚¨è‡ªå·±çš„ç ”ç©¶å’Œé£é™©æ‰¿å—èƒ½åŠ›åšå‡ºç‹¬ç«‹å†³ç­–ã€‚</p>
          </div>
          <p class="update-time" v-if="holdingsUpdatedAt">
            æœ€åæ›´æ–°äº: {{ holdingsUpdatedAt }}
          </p>

          <div class="table-container">
            <!-- æ˜¾ç¤ºæ¨¡å¼ -->
            <table v-if="!isHoldingsEditing" class="portfolio-table">
              <colgroup>
                <col style="width: 25%;"> <!-- èµ„äº§åç§°ï¼Œå æœ€å¤§ç©ºé—´ -->
                <col style="width: 25%;"> <!-- ä»£ç  -->
                <col style="width: 25%;"> <!-- æˆæœ¬ä»· -->
                <col style="width: 25%;"> <!-- å¤‡æ³¨/è¯¦æƒ…æŒ‰é’®ï¼Œä¿æŒç¨çª„ -->
              </colgroup>
              <thead>
                <tr>
                  <th>èµ„äº§åç§°</th>
                  <th>ä»£ç </th>
                  <th>æˆ‘çš„æˆæœ¬ä»·</th>
                  <th class="details-column">å¤‡æ³¨</th>
                </tr>
              </thead>
              <template v-for="(item, index) in holdingsData" :key="`display-${index}`">
                <tr class="main-row">
                  <td>{{ item.name }}</td>
                  <td>{{ item.code }}</td>
                  <td>{{ item.cost }}</td>
                  <td class="details-column">
                    <button @click="toggleDetails(index)" class="details-toggle">
                      <span :class="['arrow', { active: expandedRowIndex === index }]">â–¼</span>
                    </button>
                  </td>
                </tr>
                <Transition name="details-fade">
                  <tr v-if="expandedRowIndex === index" class="details-row">
                    <td :colspan="4">
                      <div class="details-content">
                        <h3 class="details-title">ä¹°å…¥é€»è¾‘ä¸åç»­åº”å¯¹</h3>
                        <p class="details-text">{{ item.notes }}</p>
                      </div>
                    </td>
                  </tr>
                </Transition>
              </template>
              <tbody v-if="holdingsData.length === 0">
                <tr>
                  <td :colspan="4">
                    <div class="empty-state">
                      <p>å½“å‰æš‚æ— æŒä»“å‚è€ƒã€‚</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

            <!-- ç¼–è¾‘æ¨¡å¼ -->
            <table v-else class="portfolio-table">
              <colgroup>
                <col style="width: 25%;"> <!-- èµ„äº§åç§°ï¼Œå æœ€å¤§ç©ºé—´ -->
                <col style="width: 25%;"> <!-- ä»£ç  -->
                <col style="width: 25%;"> <!-- æˆæœ¬ä»· -->
                <col style="width: 15%;"> <!-- å¤‡æ³¨/è¯¦æƒ…æŒ‰é’®ï¼Œä¿æŒç¨çª„ -->
                <col style="width: 10%;">
              </colgroup>
              <thead>
                <tr>
                  <th>èµ„äº§åç§°</th>
                  <th>ä»£ç </th>
                  <th>æˆæœ¬ä»·</th>
                  <th class="details-column">å¤‡æ³¨</th>
                  <th class="action-column">æ“ä½œ</th>
                </tr>
              </thead>
              <template v-for="(item, index) in tempHoldingsData" :key="`edit-${index}`">
                <tr class="main-row">
                  <td><input type="text" v-model="item.name" class="input-edit"></td>
                  <td><input type="text" v-model="item.code" class="input-edit"></td>
                  <td><input type="text" v-model="item.cost" class="input-edit"></td>
                  <td class="details-column">
                    <button @click="toggleDetails(index)" class="details-toggle">
                      <span :class="['arrow', { active: expandedRowIndex === index }]">â–¼</span>
                    </button>
                  </td>
                  <td class="action-column">
                    <button @click="deleteHoldingsRow(index)" class="delete-row-button">åˆ é™¤</button>
                  </td>
                </tr>
                <Transition name="details-fade">
                  <tr v-if="expandedRowIndex === index" class="details-row">
                    <td :colspan="5">
                      <div class="details-content">
                        <h3 class="details-title">ç¼–è¾‘ä¹°å…¥é€»è¾‘ä¸åç»­åº”å¯¹</h3>
                        <textarea v-model="item.notes" class="input-edit notes-edit" placeholder="è¯·åœ¨æ­¤å¤„è¾“å…¥è¯¦ç»†çš„ä¹°å…¥ç†ç”±ã€åç»­åº”å¯¹ç­–ç•¥ç­‰..."></textarea>
                      </div>
                    </td>
                  </tr>
                </Transition>
              </template>
              <tbody v-if="tempHoldingsData.length === 0">
                <tr>
                  <td :colspan="5">
                    <div class="empty-state">
                      <p>è¯·ç‚¹å‡»ä¸‹æ–¹â€œæ·»åŠ ä¸€è¡Œâ€å¼€å§‹é…ç½®æŒä»“ã€‚</p>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>

            <div v-if="isHoldingsEditing">
              <button @click="addHoldingsRow" class="add-row-button">+ æ·»åŠ ä¸€è¡Œ</button>
              <div class="edit-actions">
                <button @click="saveHoldings" class="action-button save">ä¿å­˜</button>
                <button @click="cancelHoldings" class="action-button cancel">å–æ¶ˆ</button>
              </div>
            </div>
          </div>
        </div>

        <!-- å¡ç‰‡4: FAQ -->
        <div class="content-card">
          <h2 class="card-title">å¸¸è§é—®é¢˜ (FAQ)</h2>
          <div class="faq-container">
            <div v-for="(item, index) in faqList" :key="index" class="faq-item">
              <button class="faq-question" @click="toggleFaq(index)">
                <span>{{ item.question }}</span>
                <span :class="['faq-icon', { 'is-open': openFaqIndex === index }]">+</span>
              </button>
              <div v-if="openFaqIndex === index" class="faq-answer">
                <p>{{ item.answer }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
  import { ref, onMounted, computed, inject } from 'vue'
  import { useUserStore } from '@/store/user'
  import { storeToRefs } from 'pinia'
  import app from '@/lib/cloudbase'

  // --- ä¾èµ–æ³¨å…¥å’Œå…¨å±€çŠ¶æ€ (æ— å˜åŒ–) ---
  const showMessage: any = inject('showMessage')
  const userStore = useUserStore()
  const { userInfo }: any = storeToRefs(userStore)

  // --- ç®¡ç†å‘˜æƒé™ (æ— å˜åŒ–) ---
  const isAdmin = computed(() => userInfo.value?.admin === true)

  // --- è¾…åŠ©å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´æˆ³ (æ— å˜åŒ–) ---
  const formatTimestamp = (timestamp: any) => {
      if (!timestamp) return ''
      const date = new Date(timestamp)
      if (isNaN(date.getTime())) return ''
      return `${date.getFullYear()}-${(date.getMonth() + 1).toString().padStart(2, '0')}-${date
          .getDate()
          .toString()
          .padStart(2, '0')} ${date.getHours().toString().padStart(2, '0')}:${date
          .getMinutes()
          .toString()
          .padStart(2, '0')}`
  }

  // ==================== æŒä»“å‚è€ƒçš„ç¼–è¾‘é€»è¾‘ (å·²ä¿®æ”¹ä¸ºçœŸå®APIè°ƒç”¨) ====================
  const isHoldingsEditing = ref(false)
  const holdingsData = ref<any[]>([])
  const holdingsUpdatedAt = ref('')
  let tempHoldingsData = ref<any[]>([])
  const expandedRowIndex = ref<number | null>(null)

  const toggleDetails = (index: number) => {
      if (expandedRowIndex.value === index) {
          expandedRowIndex.value = null
      } else {
          expandedRowIndex.value = index
      }
  }

  // ã€å·²ä¿®æ”¹ã€‘è·å–æŒä»“æ•°æ®çš„å‡½æ•°
  const fetchHoldingsData = async () => {
      try {
          // è°ƒç”¨æ–°çš„äº‘å‡½æ•°æ¥è·å–æ•°æ®
          const res = await app.callFunction({ name: 'getCashFlowHoldings', parse: true })

          if (res.result?.success) {
              // ä»è¿”å›çš„æ•°æ®ç»“æ„ä¸­æ­£ç¡®åœ°è§£ææ•°æ®
              holdingsData.value = res.result.data.holdings?.data || []
              holdingsUpdatedAt.value = formatTimestamp(res.result.data.holdings?.updatedAt)
          } else {
              showMessage('è·å–æŒä»“æ•°æ®å¤±è´¥', 'error')
          }
      } catch (error) {
          showMessage('ç½‘ç»œé”™è¯¯ï¼Œæ— æ³•åŠ è½½æŒä»“æ•°æ®', 'error')
      }
  }

  const editHoldings = () => {
      tempHoldingsData.value = JSON.parse(JSON.stringify(holdingsData.value))
      expandedRowIndex.value = null
      isHoldingsEditing.value = true
  }

  // ã€å·²ä¿®æ”¹ã€‘ä¿å­˜æ›´æ”¹çš„å‡½æ•°
  const saveHoldings = async () => {
      showMessage('æ­£åœ¨ä¿å­˜...', 'info')
      try {
          // è°ƒç”¨æ–°çš„äº‘å‡½æ•°æ¥æ›´æ–°æ•°æ®ï¼Œå¹¶ä¼ é€’æ­£ç¡®çš„ payload
          const res = await app.callFunction({
              name: 'updateCashFlowHoldings',
              parse: true,
              data: { holdings: tempHoldingsData.value } // åç«¯éœ€è¦ä¸€ä¸ªåŒ…å« holdings æ•°ç»„çš„å¯¹è±¡
          })

          if (res.result?.success) {
              showMessage('æŒä»“ä¿å­˜æˆåŠŸ', 'success')
              isHoldingsEditing.value = false
              fetchHoldingsData() // ä¿å­˜æˆåŠŸåï¼Œé‡æ–°è·å–æœ€æ–°æ•°æ®ä»¥åˆ·æ–°é¡µé¢
          } else {
              showMessage('ä¿å­˜å¤±è´¥: ' + res.result?.message, 'error')
          }
      } catch (error) {
          showMessage('ç½‘ç»œé”™è¯¯ï¼Œä¿å­˜å¤±è´¥', 'error')
      }
  }

  const cancelHoldings = () => {
      expandedRowIndex.value = null
      isHoldingsEditing.value = false
  }

  const addHoldingsRow = () => {
      tempHoldingsData.value.push({ name: '', code: '', cost: '', notes: 'è¯·åœ¨æ­¤å¤„å¡«å†™ä¹°å…¥é€»è¾‘...' })
  }

  const deleteHoldingsRow = (index: number) => {
      tempHoldingsData.value.splice(index, 1)
  }
  // ================================================================

  // --- FAQ é€»è¾‘ (æ— å˜åŒ–) ---
  const openFaqIndex = ref<number | null>(0)
  const toggleFaq = (index: number) => {
      openFaqIndex.value = openFaqIndex.value === index ? null : index
  }
  const faqList = ref([
      {
          question: 'æˆ‘åº”è¯¥å®Œå…¨å¤åˆ¶ä½ çš„æŒä»“å’Œæˆæœ¬ä»·å—ï¼Ÿ',
          answer: 'ç»å¯¹ä¸è¦ã€‚è¿™ä¸ªåˆ—è¡¨æ˜¯â€œè¿‡å»æ—¶â€å’Œâ€œè¿›è¡Œæ—¶â€çš„ç»“åˆï¼Œæˆ‘çš„æˆæœ¬ä»·æ˜¯å†å²æ“ä½œçš„ç»“æœï¼Œå¹¶ä¸ä»£è¡¨ç°åœ¨æ˜¯ä¹°å…¥çš„å¥½æ—¶æœºã€‚å®ƒæœ€å¤§çš„ä½œç”¨æ˜¯è®©ä½ äº†è§£ç°é‡‘æµç­–ç•¥å¯èƒ½åŒ…å«å“ªäº›ç±»å‹çš„èµ„äº§ï¼Œå¯å‘ä½ å»åšè‡ªå·±çš„ç ”ç©¶ã€‚'
      },
      {
          question: 'è¿™ä¸ªç­–ç•¥çš„é£é™©æ˜¯ä»€ä¹ˆï¼Ÿ',
          answer: 'ä¸»è¦é£é™©æœ‰ä¸¤ä¸ªï¼šä¸€æ˜¯å•ä¸ªå…¬å¸ç»è¥ä¸å–„ï¼Œå¯¼è‡´å‰Šå‡ç”šè‡³å–æ¶ˆåˆ†çº¢ï¼Œè¿™ä¼šç›´æ¥å½±å“ç°é‡‘æ”¶å…¥ï¼›äºŒæ˜¯å¸‚åœºç³»ç»Ÿæ€§é£é™©ï¼Œå³ä½¿æ˜¯ä¼˜è´¨å…¬å¸ï¼Œåœ¨ç†Šå¸‚ä¸­è‚¡ä»·ä¹Ÿå¯èƒ½å¤§å¹…ä¸‹è·Œï¼Œé€ æˆè´¦é¢æµ®äºã€‚æ­¤å¤–ï¼Œåˆ©ç‡ä¸Šå‡ä¹Ÿå¯èƒ½å¯¹é«˜è‚¡æ¯èµ„äº§çš„ä¼°å€¼äº§ç”Ÿå‹åŠ›ã€‚'
      },
      {
          question: 'ä½ çš„æŒä»“ä¼šæ›´æ–°å—ï¼Ÿå¤šä¹…æ›´æ–°ä¸€æ¬¡ï¼Ÿ',
          answer: 'ä¼šçš„ã€‚æˆ‘ä¼šä¸å®šæœŸåœ°æ ¹æ®å¸‚åœºæƒ…å†µã€å…¬å¸åŸºæœ¬é¢å˜åŒ–ä»¥åŠæ›´å¥½çš„æŠ•èµ„æœºä¼šå‡ºç°æ—¶ï¼Œå¯¹æŒä»“è¿›è¡Œå¾®è°ƒã€‚ä½†æ€»ä½“æ¥è¯´ï¼Œè¿™æ˜¯ä¸€ä¸ªâ€œä½æ¢æ‰‹ç‡â€çš„ç­–ç•¥ï¼Œä¸ä¼šé¢‘ç¹ä¹°å–ã€‚å…·ä½“çš„æ›´æ–°é¢‘ç‡æ²¡æœ‰å›ºå®šæ—¶é—´è¡¨ã€‚'
      },
      {
          question: 'è¿™ä¸ªç­–ç•¥èƒ½è·‘èµ¢å¤§ç›˜æŒ‡æ•°å—ï¼Ÿ',
          answer: 'ä¸ä¸€å®šã€‚åœ¨å¸‚åœºå¿«é€Ÿä¸Šæ¶¨çš„å¤§ç‰›å¸‚ä¸­ï¼Œç°é‡‘æµç­–ç•¥çš„è¡¨ç°é€šå¸¸ä¼šè½åäºé«˜æˆé•¿çš„æŒ‡æ•°ï¼ˆå¦‚åˆ›ä¸šæ¿æŒ‡ï¼‰ã€‚å®ƒçš„ä¼˜åŠ¿åœ¨äºå¸‚åœºéœ‡è¡æˆ–ä¸‹è·Œæ—¶ï¼Œèƒ½æä¾›æ›´å¼ºçš„é˜²å¾¡æ€§å’Œç¨³å®šçš„ç°é‡‘å›æŠ¥ï¼Œä½¿å¾—æŒæœ‰ä½“éªŒæ›´å¹³æ»‘ã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯é•¿æœŸæ€»å›æŠ¥ï¼Œè€ŒéçŸ­æœŸæ¯”è¾ƒã€‚'
      }
  ])

  // --- ç»„ä»¶æŒ‚è½½ (æ— å˜åŒ–) ---
  onMounted(() => {
      fetchHoldingsData()
  })
</script>
<style scoped>
  /* Base styles remain the same */
  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(20px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }
  .page-wrapper {
      font-family: 'Noto Sans SC', sans-serif;
      background-color: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 3rem 1rem;
      background: radial-gradient(circle at 15% 50%, #1a2a4a, transparent 40%),
          radial-gradient(circle at 85% 50%, #4a3a2a, transparent 40%), #121212;
  }
  .main-container {
      max-width: 900px;
      margin: 0 auto;
  }
  .page-header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.5s ease-out forwards;
      opacity: 0;
  }
  .back-button {
      color: #b0c4de;
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.3s ease;
      display: inline-block;
      margin-bottom: 1rem;
  }
  .back-button:hover {
      color: #00aaff;
  }
  .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
  }
  .title-icon {
      font-size: 2.8rem;
      text-shadow: 0 0 15px;
  }
  .title-icon.cash-flow {
      color: #e59866;
      text-shadow: 0 0 15px #e59866;
  }
  .subtitle {
      font-size: 1.1rem;
      color: #b0c4de;
  }
  .content-grid {
      display: grid;
      gap: 1.5rem;
  }
  .content-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem 2rem;
      backdrop-filter: blur(10px);
      transition: border-color 0.3s ease;
      min-width: 0;
      animation: fadeInUp 0.5s ease-out forwards;
      opacity: 0;
  }
  .content-card:hover {
      border-color: rgba(229, 152, 102, 0.5);
  }
  .content-card:nth-child(1) {
      animation-delay: 0.2s;
  }
  .content-card:nth-child(2) {
      animation-delay: 0.3s;
  }
  .content-card:nth-child(3) {
      animation-delay: 0.4s;
  }
  .content-card:nth-child(4) {
      animation-delay: 0.5s;
  }
  .card-title {
      font-size: 1.4rem;
      font-weight: bold;
      color: #ffffff;
      margin-top: 0;
      margin-bottom: 1rem;
      border-left: 4px solid #e59866;
      padding-left: 1rem;
  }
  .card-description {
      font-size: 0.95rem;
      color: #b0c4de;
      line-height: 1.7;
  }
  .idea-list {
      list-style: none;
      padding-left: 0;
      margin-top: 1.5rem;
  }
  .idea-list li {
      position: relative;
      padding-left: 1.8rem;
      margin-bottom: 1.5rem;
      line-height: 1.7;
      color: #b0c4de;
  }
  .idea-list li:last-child {
      margin-bottom: 0;
  }
  .idea-list li::before {
      content: 'âœ”';
      position: absolute;
      left: 0;
      top: 2px;
      color: #e59866;
      font-weight: bold;
      font-size: 1rem;
  }
  .idea-list li b {
      display: block;
      color: #ffffff;
      font-weight: 700;
      margin-bottom: 0.4rem;
  }
  .disclaimer-box {
      background: rgba(229, 152, 102, 0.08);
      border: 1px solid rgba(229, 152, 102, 0.3);
      border-radius: 8px;
      padding: 1rem 1.2rem;
      margin-bottom: 1rem;
  }
  .disclaimer-box p {
      margin: 0;
      font-size: 0.9rem;
      color: #f5cba7;
      line-height: 1.6;
  }
  .disclaimer-box strong {
      color: #e59866;
  }

  /* ==================== æœ€ç»ˆç‰ˆè¡¨æ ¼å’Œå¯å±•å¼€è¡Œæ ·å¼ ==================== */
  .table-container {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
  }
  .portfolio-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
  } /* Use separate for better control */
  .portfolio-table th,
  .portfolio-table td {
      padding: 0.8rem 1rem;
      text-align: left;
      vertical-align: middle;
  }
  .portfolio-table th {
      color: #ffffff;
      font-weight: bold;
      font-size: 0.9rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.2);
  }
  .portfolio-table .main-row td {
      color: #b0c4de;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  /* åˆ—å¯¹é½ä¸å®½åº¦æ§åˆ¶ */
  .portfolio-table th.details-column,
  .portfolio-table td.details-column {
      text-align: center;
  }
  .portfolio-table th.action-column,
  .portfolio-table td.action-column {
      text-align: center;
  }

  /* å…¨æ–°å›¾æ ‡æŒ‰é’®æ ·å¼ */
  .details-toggle {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      width: 32px;
      height: 32px;
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #b0c4de;
      border-radius: 50%;
      cursor: pointer;
      padding: 0;
      transition: all 0.3s ease;
  }
  .details-toggle:hover {
      background-color: #e59866;
      border-color: #e59866;
      color: #fff;
  }
  .details-toggle .arrow {
      font-size: 1rem;
      line-height: 1;
      transition: transform 0.3s ease;
  }
  .details-toggle .arrow.active {
      transform: rotate(180deg);
  }

  .details-row td {
      padding: 0;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  .details-content {
      background: rgba(0, 0, 0, 0.2);
      padding: 1.5rem;
      border-left: 4px solid #e59866;
      box-shadow: inset 0 5px 15px -5px rgba(0, 0, 0, 0.4);
  }
  .details-title {
      margin-top: 0;
      margin-bottom: 1rem;
      font-size: 1.1rem;
      color: #fff;
  }
  .details-text {
      margin: 0;
      font-size: 0.95rem;
      line-height: 1.8;
      color: #b0c4de;
      white-space: pre-wrap;
  }

  /* å±•å¼€/æ”¶èµ·åŠ¨ç”» */
  .details-fade-enter-active,
  .details-fade-leave-active {
      transition: opacity 0.4s ease, transform 0.4s ease;
  }
  .details-fade-enter-from,
  .details-fade-leave-to {
      opacity: 0;
      transform: translateY(-10px);
  }
  /* ==================================================================== */

  /* --- ç¼–è¾‘åŠŸèƒ½ç›¸å…³æ ·å¼ --- */
  .card-header-with-admin {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      border-left: 4px solid #e59866;
      padding-left: 1rem;
  }
  .card-title.no-border {
      border-left: none;
      padding-left: 0;
      margin-bottom: 0;
  }
  .edit-button {
      padding: 0.4rem 1rem;
      font-size: 0.85rem;
      color: #fff;
      background-color: rgba(255, 255, 255, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.3);
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
  }
  .edit-button:hover {
      background-color: #e59866;
      border-color: #e59866;
  }
  .update-time {
      font-size: 0.8rem;
      color: #8392a5;
      margin-top: -0.5rem;
      margin-bottom: 1rem;
  }
  .input-edit {
      width: 100%;
      background-color: rgba(0, 0, 0, 0.2);
      border: 1px solid #8392a5;
      border-radius: 4px;
      color: #fff;
      padding: 0.5rem;
      box-sizing: border-box;
  }
  .input-edit:focus {
      outline: none;
      border-color: #e59866;
  }
  .notes-edit {
      min-height: 200px;
      resize: vertical;
      font-family: inherit;
      line-height: 1.7;
  }
  .delete-row-button {
      background: none;
      border: none;
      color: #ff8a80;
      cursor: pointer;
      text-decoration: underline;
      padding: 0;
      font-size: 0.85rem;
  }
  .add-row-button {
      width: 100%;
      border: 2px dashed rgba(255, 255, 255, 0.2);
      background: transparent;
      color: #b0c4de;
      padding: 0.6rem;
      margin-top: 1rem;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
  }
  .add-row-button:hover {
      background-color: rgba(229, 152, 102, 0.1);
      border-color: rgba(229, 152, 102, 0.5);
  }
  .empty-state {
      text-align: center;
      padding: 2rem 0;
      background: transparent;
  }
  .empty-state p {
      margin: 0;
      color: #b0c4de;
  }
  .edit-actions {
      margin-top: 1.5rem;
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
  }
  .action-button {
      padding: 0.5rem 1.2rem;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      color: #fff;
      font-weight: bold;
      transition: all 0.3s;
  }
  .action-button.save {
      background-color: #e59866;
  }
  .action-button.save:hover {
      opacity: 0.9;
  }
  .action-button.cancel {
      background-color: rgba(255, 255, 255, 0.2);
  }
  .action-button.cancel:hover {
      background-color: rgba(255, 255, 255, 0.3);
  }

  /* --- FAQ æ ·å¼ --- */
  .faq-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
  }
  .faq-item {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }
  .faq-item:last-child {
      border-bottom: none;
  }
  .faq-question {
      width: 100%;
      text-align: left;
      padding: 1rem 0;
      background: none;
      border: none;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
  }
  .faq-icon {
      font-size: 1.5rem;
      font-weight: bold;
      transition: transform 0.3s ease;
      color: #e59866;
  }
  .faq-icon.is-open {
      transform: rotate(45deg);
  }
  .faq-answer {
      padding-bottom: 1rem;
      color: #b0c4de;
      line-height: 1.7;
  }

  /* --- å“åº”å¼ --- */
  html,
  body {
      overflow-x: hidden;
  }
  @media (max-width: 768px) {
      .page-wrapper {
          padding: 2rem 1rem;
          width: 100%;
          box-sizing: border-box;
      }
      .main-container {
          width: 100%;
          max-width: 100%;
      }
      .page-header {
          margin-bottom: 2.5rem;
      }
      .back-button {
          font-size: 1rem;
          margin-bottom: 1.5rem;
          display: block;
      }
      .main-title {
          font-size: 2rem;
          gap: 0.8rem;
      }
      .subtitle {
          font-size: 1rem;
      }
      .content-card {
          padding: 1.2rem;
      }
      .card-title {
          font-size: 1.25rem;
          padding-left: 0.8rem;
      }
      .card-description {
          font-size: 0.9rem;
      }
      .table-container {
          min-width: 100%;
      }
      .portfolio-table {
          min-width: 500px;
      }
  }
</style>