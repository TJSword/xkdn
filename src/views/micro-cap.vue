<template>
  <div class="page-wrapper">
    <div class="main-container">

      <div class="page-header">
        <router-link to="/home" class="back-button">
          â† è¿”å›ä¸»é¡µ
        </router-link>
        <h1 class="main-title">
          <span class="title-icon">ğŸ’</span>
          å¾®ç›˜è‚¡ç­–ç•¥
        </h1>
        <p class="subtitle">
          ç”¨é‡åŒ–çºªå¾‹è¿½è¸ªæŒ‡æ•°ï¼Œæ•æ‰å¸‚åœºæ·±å¤„çš„è§„æ¨¡å› å­ã€‚
        </p>
      </div>

      <div class="content-grid">

        <div class="content-card risk-warning-card">
          <h2 class="card-title">æç«¯é£é™©è­¦å‘Š</h2>
          <p class="card-description">
            å¾®ç›˜è‚¡ç­–ç•¥æ˜¯æ‰€æœ‰ç­–ç•¥ä¸­é£é™©ç­‰çº§æœ€é«˜çš„ã€‚è¯¥ç­–ç•¥æ‰€è¿½è¸ªçš„æŒ‡æ•°æˆåˆ†è‚¡æ™®éè§„æ¨¡å°ã€åŸºæœ¬é¢ä¸ç¡®å®šæ€§å¼ºï¼Œå¯¼è‡´æ•´ä½“æ³¢åŠ¨æä¸ºå‰§çƒˆï¼Œå¯èƒ½åœ¨çŸ­æœŸå†…å‡ºç°è¶…è¿‡50%ç”šè‡³æ›´å¤šçš„å‡€å€¼å›æ’¤ã€‚
            åŒæ—¶ï¼Œæˆåˆ†è‚¡çš„æµåŠ¨æ€§é£é™©å¯èƒ½ä¼ å¯¼è‡³ç­–ç•¥æœ¬èº«ã€‚<strong>æœ¬ç­–ç•¥åªé€‚åˆé£é™©æ‰¿å—èƒ½åŠ›æå¼ºçš„æŠ•èµ„è€…ï¼Œä¸”æŠ•å…¥èµ„é‡‘å¿…é¡»æ˜¯å®Œå…¨å¯ä»¥æ‰¿å—æŸå¤±çš„é—²é’±ã€‚</strong>
          </p>
        </div>

        <div class="content-card">
          <h2 class="card-title">ç»„åˆæ€æƒ³ï¼šé‡åŒ–è¿½è¸ªï¼Œçºªå¾‹æ‰§è¡Œ</h2>
          <p class="card-description">
            æœ¬ç­–ç•¥å¹¶éä¸»åŠ¨æŒ–æ˜ä¸ªè‚¡ï¼Œè€Œæ˜¯é€šè¿‡é‡åŒ–æ¨¡å‹ç´§å¯†è¿½è¸ª<b>ä¸‡å¾—å¾®ç›˜è‚¡æŒ‡æ•°</b>ï¼Œæ—¨åœ¨ç³»ç»Ÿæ€§åœ°æ•è·Aè‚¡å¸‚åœºçš„â€œè§„æ¨¡å› å­â€æº¢ä»·ã€‚
          </p>
          <ul class="idea-list">
            <li><b>è§„æ¨¡å› å­æº¢ä»·ï¼š</b> å­¦æœ¯ä¸å†å²æ•°æ®å‡è¡¨æ˜ï¼Œé•¿æœŸæ¥çœ‹ï¼Œå°å¸‚å€¼å…¬å¸çš„æ•´ä½“å›æŠ¥ç‡å€¾å‘äºè¶…è¶Šå¤§å¸‚å€¼å…¬å¸ã€‚æœ¬ç­–ç•¥çš„ç›®æ ‡æ­£æ˜¯æ•è·è¿™ç§ç”±â€œè§„æ¨¡â€è¿™ä¸€å› å­æœ¬èº«å¸¦æ¥çš„ç³»ç»Ÿæ€§è¶…é¢æ”¶ç›Šã€‚</li>
            <li><b>æ¯å‘¨åŠ¨æ€å†å¹³è¡¡ï¼š</b> æ¨¡å‹äº<b>æ¯å‘¨ä¸€</b>è¿›è¡Œè°ƒä»“ã€‚è¿™ç§å†å¹³è¡¡æœºåˆ¶ï¼Œç¡®ä¿äº†ç­–ç•¥èƒ½ç´§å¯†è·ŸéšæŒ‡æ•°çš„æˆåˆ†å˜åŒ–ï¼Œå¹¶åŠæ—¶æ•æ‰å¸‚åœºåŠ¨é‡ï¼Œæ˜¯ç­–ç•¥è·å–é˜¿å°”æ³•æ”¶ç›Šçš„å…³é”®ç¯èŠ‚ã€‚</li>
            <li><b>ä½œä¸ºâ€œå«æ˜Ÿâ€é…ç½®ï¼š</b> é‰´äºå¾®ç›˜è‚¡çš„é«˜æ³¢åŠ¨ç‰¹æ€§ï¼Œå®ƒé€‚åˆä½œä¸ºæŠ•èµ„ç»„åˆä¸­çš„â€œå«æ˜Ÿâ€éƒ¨åˆ†ï¼Œç”¨ä»¥å¢å¼ºæ•´ä½“æ”¶ç›Šå¼¹æ€§ã€‚å»ºè®®é…ç½®æ¯”ä¾‹ä¸è¶…è¿‡æ€»æŠ•èµ„èµ„äº§çš„20%ï¼Œå¹¶åšå¥½é•¿æœŸæŒæœ‰çš„å‡†å¤‡ã€‚</li>
          </ul>
        </div>
        <div class="content-card">
          <h2 class="card-title">æœ€æ–°æŒä»“ä¸è°ƒä»“å»ºè®®</h2>
          <p class="card-description">
            æ ¹æ®æ¨¡å‹äº {{ formattedDate }} ç”Ÿæˆçš„æœ€æ–°ç»„åˆã€‚
          </p>
          <div class="calculator-toolbar">
            <div class="calc-left">
              <div class="input-wrapper">
                <span class="currency-symbol">Â¥</span>
                <input type="number" v-model="inputAmount" class="compact-input" placeholder="è®¡åˆ’æŠ•å…¥é‡‘é¢" @keyup.enter="handleCalculate" />
              </div>
              <button class="calc-btn-compact" @click="handleCalculate">
                è®¡ç®—
              </button>
            </div>

            <div v-if="hasCalculated" class="calc-summary-inline">
              <div class="summary-tag">
                <span class="label">è®¡åˆ’ä¹°å…¥</span>
                <span class="value highlight">{{ calcSummary.totalPlanned.toFixed(0) }}</span>
              </div>
              <div class="summary-tag">
                <span class="label">åˆ©ç”¨ç‡</span>
                <span class="value" :class="{'warn': parseFloat(calcSummary.utilization) < 95}">
                  {{ calcSummary.utilization }}
                </span>
              </div>
              <div class="summary-tag">
                <span class="label">ç»“ä½™</span>
                <span class="value">{{ (Number(inputAmount) - calcSummary.totalPlanned).toFixed(0) }}</span>
              </div>
            </div>
          </div>

          <h3 class="card-subtitle">æ ¸å¿ƒæŒä»“å±•ç¤º (10åª)</h3>
          <div class="table-wrapper">
            <table class="data-table portfolio-table">
              <thead>
                <tr>
                  <th>ä»£ç </th>
                  <th>åç§°</th>
                  <th>ç°ä»·</th>
                  <th v-if="hasCalculated" class="calc-col-head">å»ºè®®æ‰‹æ•°</th>
                  <th v-if="hasCalculated" class="calc-col-head">è®¡åˆ’é‡‘é¢</th>
                  <th v-if="hasCalculated" class="calc-col-head">å æ¯”</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="item in latestPortfolio" :key="item.code">
                  <td class="code-font">{{ item.code }}</td>
                  <td>{{ item.name }}</td>
                  <td>{{ item.price.toFixed(2) }}</td>

                  <template v-if="hasCalculated">
                    <td class="calc-col-cell">
                      <span class="calc-val">{{ allocationData.get(item.code)?.shares || 0 }}</span>
                    </td>
                    <td class="calc-col-cell">
                      <span class="calc-val">{{ allocationData.get(item.code)?.cost.toFixed(0) || 0 }}</span>
                    </td>
                    <td class="calc-col-cell">
                      <span class="calc-val">{{ allocationData.get(item.code)?.weight || '0%' }}</span>
                    </td>
                  </template>
                </tr>
              </tbody>
            </table>
          </div>

          <h3 class="card-subtitle" style="margin-top: 2rem;">ç»„åˆè°ƒä»“æŒ‡å¼•</h3>
          <div class="adjustments-grid">
            <div class="adjustment-block">
              <h4 class="adjustment-title sell">â¬‡ï¸ å»ºè®®è°ƒå‡º</h4>
              <ul class="adjustment-list">
                <li v-for="item in sellList" :key="item.code" class="adjustment-item">
                  <span>{{ item.name }} ({{ item.code }})</span>
                  <span class="action-badge sell">å–å‡º</span>
                </li>
                <li v-if="sellList.length == 0" class="adjustment-item-empty">ä»Šæ—¥æ— è°ƒå‡ºå»ºè®®</li>
              </ul>
            </div>
            <div class="adjustment-block">
              <h4 class="adjustment-title buy">â¬†ï¸ å»ºè®®è°ƒå…¥</h4>
              <ul class="adjustment-list">
                <li v-for="item in buyList" :key="item.code" class="adjustment-item">
                  <span>{{ item.name }} ({{ item.code }})</span>
                  <span class="action-badge buy">ä¹°å…¥</span>
                </li>
                <li v-if="buyList.length === 0" class="adjustment-item-empty">ä»Šæ—¥æ— è°ƒå…¥å»ºè®®</li>
              </ul>
            </div>
          </div>
        </div>

        <div class="content-card">
          <div class="card-header-row">
            <h2 class="card-title no-margin">å¾®ç›˜è‚¡ç­–ç•¥ vs æ²ªæ·±300å…¨æ”¶ç›Š</h2>
            <span class="period-badge">å›æµ‹å‘¨æœŸ: 2013-01-04 è‡³ 2025-12-31</span>
          </div>

          <div ref="chartContainer" class="echart-container"></div>

          <div class="stats-bar">
            <div class="stat-item">
              <div class="stat-label">æ€»æ”¶ç›Š</div>
              <div class="stat-value highlight">45555.11%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">å¹´åŒ–æ”¶ç›Š</div>
              <div class="stat-value">60.10%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">æ³¢åŠ¨ç‡</div>
              <div class="stat-value">29.02%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">å¤æ™®æ¯”ç‡</div>
              <div class="stat-value">2.002</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">æœ€å¤§å›æ’¤</div>
              <div class="stat-value negative">-50.92%</div>
            </div>
          </div>
        </div>

        <div class="content-card">
          <h2 class="card-title">ç­–ç•¥æœˆåº¦/å¹´åº¦æ”¶ç›Šè¡¨</h2>
          <div class="table-container heatmap-container">
            <table class="heatmap-table">
              <thead>
                <tr>
                  <th>å¹´ä»½</th>
                  <th v-for="m in 12" :key="m">{{ m }}æœˆ</th>
                  <th>å¹´åº¦</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="yearData in monthlyReturns" :key="yearData.year">
                  <td class="year-col">{{ yearData.year }}</td>
                  <td v-for="(val, idx) in yearData.months" :key="idx" :style="getHeatmapStyle(val)" class="cell-val">
                    {{ val !== null ? val + '%' : '' }}
                  </td>
                  <td class="year-total" :style="getHeatmapStyle(yearData.total)">
                    {{ yearData.total }}%
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="content-card">
          <h2 class="card-title">æ·±åº¦é£é™©åˆ†æ</h2>

          <div class="risk-summary-grid">
            <div class="risk-box">
              <div class="risk-label">å¡ç›æ¯”ç‡ (Calmar)</div>
              <div class="risk-main-val">1.180</div>
              <div class="risk-sub-val">å¹´åŒ–æ”¶ç›Š / æœ€å¤§å›æ’¤</div>
            </div>
            <div class="risk-box">
              <div class="risk-label"> æœˆåº¦èƒœç‡: 63.5%</div>
              <div class="risk-main-val">99 / 156</div>
              <div class="risk-sub-val">ç›ˆåˆ©æœˆæ•° / æ€»æœˆæ•°</div>
            </div>
            <div class="risk-box">
              <div class="risk-label">ç›ˆäºæ¯”</div>
              <div class="risk-main-val">0.927</div>
              <div class="risk-sub-val">æ—¥å‡ç›ˆåˆ© / æ—¥å‡äºæŸ</div>
            </div>
          </div>

          <h3 class="card-subtitle no-border">å›æ’¤æ·±åº¦åˆ†å¸ƒ (é¢‘ç‡ç»Ÿè®¡)</h3>
          <div class="table-container dist-table-container">
            <div class="dist-table-inner">
              <div class="dist-header-row">
                <div class="dist-col" v-for="item in drawdownDist" :key="item.range">{{ item.range }}</div>
              </div>
              <div class="dist-bar-row">
                <div class="dist-col" v-for="item in drawdownDist" :key="item.range">
                  <div class="dist-block yellow-theme" :style="{ opacity: item.count > 0 ? 1 : 0.6 }">
                    {{ item.count }}
                  </div>
                </div>
              </div>
              <div class="dist-label-row">
                <div class="dist-col">æ¬¡æ•°</div>
              </div>
            </div>
          </div>

          <h3 class="card-subtitle no-border" style="margin-top: 2rem;">å†å²é‡å¤§å›æ’¤æ˜ç»† (Top 10)</h3>
          <div class="table-wrapper">
            <table class="data-table risk-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>å¼€å§‹æ—¥æœŸ</th>
                  <th>è°·åº•æ—¥æœŸ</th>
                  <th>æ¢å¤æ—¥æœŸ</th>
                  <th>æœ€å¤§å›æ’¤</th>
                  <th>å›æ’¤æœŸ(å¤©)</th>
                  <th>ä¿®å¤æœŸ(å¤©)</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(item, index) in topDrawdowns" :key="index">
                  <td>{{ index + 1 }}</td>
                  <td>{{ item.start }}</td>
                  <td>{{ item.trough }}</td>
                  <td>{{ item.end }}</td>
                  <td class="negative">{{ item.maxDd }}%</td>
                  <td>{{ item.ddDays }}</td>
                  <td>{{ item.recDays }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="content-card">
          <h2 class="card-title">å¸¸è§é—®é¢˜ (FAQ)</h2>
          <div class="faq-container">
            <div v-for="(item, index) in faqList" :key="index" class="faq-item">
              <button class="faq-question" @click="toggleFaq(index)">
                <span>{{ item.question }}</span>
                <span :class="['faq-icon', { 'is-open': openFaqIndex === index }]">+</span>
              </button>
              <div v-if="openFaqIndex === index" class="faq-answer">
                <p style="white-space: pre-line;">{{ item.answer }}</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
  import { ref, onMounted, nextTick } from 'vue'
  import * as echarts from 'echarts'
  // å¼•å…¥äº‘å¼€å‘ SDK (è¯·ç¡®ä¿è·¯å¾„ä¸æ‚¨é¡¹ç›®ä¸€è‡´ï¼Œé€šå¸¸æ˜¯ @/lib/cloudbase æˆ–ç±»ä¼¼çš„)
  import app from '@/lib/cloudbase'
  import axios from 'axios'
  const showMessage: any = inject('showMessage')
  const hasCalculated = ref(false) // æ–°å¢å¼€å…³

  // --- æ–°å¢ï¼šèµ„é‡‘åˆ†é…è®¡ç®—å™¨é€»è¾‘ ---
  const inputAmount = ref<number | null>(null) // ç”¨æˆ·è¾“å…¥çš„é‡‘é¢
  const allocationData = ref<Map<string, any>>(new Map()) // å­˜å‚¨è®¡ç®—ç»“æœ Key: stockCode
  const calcSummary = ref({
      totalPlanned: 0,
      utilization: '0.00%',
      msg: ''
  })

  // è®¡ç®—æœ€å°èµ·æŠ•é—¨æ§› (æœ€é«˜ä»·è‚¡ç¥¨çš„1æ‰‹ * 10)
  const minThreshold = computed(() => {
      if (!latestPortfolio.value || latestPortfolio.value.length === 0) return 0
      const maxPrice = Math.max(...latestPortfolio.value.map((s: any) => s.price))
      return Math.ceil(maxPrice * 100 * 10)
  })

  // æ‰§è¡Œè®¡ç®— (å®Œå…¨å¤åˆ»æ‚¨çš„ç®—æ³•)
  const handleCalculate = () => {
      const stocks = latestPortfolio.value
      const totalFunds = Number(inputAmount.value)

      // 1. åŸºç¡€æ ¡éªŒ
      if (!totalFunds || totalFunds <= 0) {
          showMessage('è¯·è¾“å…¥æœ‰æ•ˆçš„æŠ•èµ„é‡‘é¢ï¼', 'error')
          return
      }
      if (totalFunds < minThreshold.value) {
          showMessage(
              `èµ„é‡‘é‡è¿‡å°ï¼Œæ— æ³•æœ‰æ•ˆè¿›è¡Œç­‰æƒé…ç½®ã€‚\nå½“å‰ç­–ç•¥å»ºè®®æœ€ä½èµ·æŠ•é‡‘é¢ä¸ºï¼š${minThreshold.value}å…ƒ\n(åŸºäºæœ€é«˜ä»·è‚¡1æ‰‹ä»·æ ¼çš„10å€è®¡ç®—)`,
              'error'
          )
          return
      }

      // 2. ç®—æ³•åˆå§‹åŒ–
      // å‡è®¾èµ„é‡‘åˆ©ç”¨ç‡ä¸º 100% (æˆ–è€…æ‚¨å¯ä»¥åƒåŸä»£ç é‚£æ ·è®¾ç½®ä¸€ä¸ªæ¯”ä¾‹ï¼Œè¿™é‡Œé»˜è®¤å…¨é¢åˆ©ç”¨)
      const fundsForAllocation = totalFunds
      let remainingFunds = fundsForAllocation
      const tempMap = new Map()
      let totalAllocated = 0

      // 3. å¾ªç¯è®¡ç®— (ç€‘å¸ƒæµåˆ†é…)
      for (let i = 0; i < stocks.length; i++) {
          const stock = stocks[i]
          const currentPrice = stock.price // æ³¨æ„ï¼šæ‚¨åŸä»£ç æ˜¯ spï¼Œè¿™é‡Œé€‚é…ä¸º price

          if (!currentPrice || currentPrice <= 0) continue

          const remainingStocksCount = stocks.length - i
          // æ ¸å¿ƒé€»è¾‘ï¼šå‰©ä½™èµ„é‡‘ / å‰©ä½™è‚¡ç¥¨æ•°
          const idealInvestmentPerStock = remainingFunds / remainingStocksCount
          const idealShares = idealInvestmentPerStock / currentPrice

          // å››èˆäº”å…¥åˆ°æ•´ç™¾
          let sharesToBuy = Math.round(idealShares / 100) * 100

          // å…œåº•é€»è¾‘ï¼šå¦‚æœè®¡ç®—å‡º0æ‰‹ï¼Œå¼ºåˆ¶ç»™1æ‰‹ (å‰ææ˜¯èµ„é‡‘è¶³å¤Ÿï¼Œä¸‹é¢ä¼šæ ¡éªŒ)
          if (sharesToBuy === 0) sharesToBuy = 100

          let actualCost = sharesToBuy * currentPrice

          // èµ„é‡‘ä¸è¶³æ—¶çš„å›é€€é€»è¾‘ (å‡å°‘æ‰‹æ•°ç›´åˆ°ä¹°å¾—èµ·)
          while (actualCost > remainingFunds && sharesToBuy > 0) {
              sharesToBuy -= 100
              actualCost = sharesToBuy * currentPrice
          }

          // è®°å½•ç»“æœ
          if (sharesToBuy > 0) {
              remainingFunds -= actualCost
              totalAllocated += actualCost

              const actualWeight = actualCost / fundsForAllocation

              tempMap.set(stock.code, {
                  shares: sharesToBuy,
                  cost: actualCost,
                  weight: (actualWeight * 100).toFixed(2) + '%'
              })
          } else {
              // æç«¯æƒ…å†µä¹°ä¸èµ·
              tempMap.set(stock.code, { shares: 0, cost: 0, weight: '0%' })
          }
      }

      // 4. æ›´æ–°çŠ¶æ€
      allocationData.value = tempMap
      calcSummary.value = {
          totalPlanned: totalAllocated,
          utilization: ((totalAllocated / fundsForAllocation) * 100).toFixed(2) + '%',
          msg: 'è®¡ç®—å®Œæˆ'
      }
      hasCalculated.value = true
  }

  // ... (ä¿ç•™åŸæœ‰çš„ fetchStrategyData, chart ç­‰é€»è¾‘)
  // --- 1. åŸºç¡€æ•°æ® ---
  const formattedDate = ref('åŠ è½½ä¸­...')
  const isLoading = ref(true)

  // --- 2. æŒä»“ä¸è°ƒä»“æ•°æ® ---
  const latestPortfolio: any = ref([]) // æ ¸å¿ƒæŒä»“
  const sellList: any = ref([]) // å»ºè®®å–å‡º
  const buyList: any = ref([]) // å»ºè®®ä¹°å…¥

  // --- 3. è·å–äº‘ç«¯æ•°æ®å‡½æ•° ---
  const fetchStrategyData = async () => {
      try {
          const res = await app.callFunction({
              name: 'getMicroCapData10' // åˆšæ‰åˆ›å»ºçš„äº‘å‡½æ•°åç§°
          })

          if (res.result.success && res.result.data) {
              const data = res.result.data

              // 1. æ›´æ–°æ—¥æœŸ
              formattedDate.value = data.updated_at

              // 2. æ›´æ–°æŒä»“åˆ—è¡¨ (æ•°æ®åº“å­—æ®µ ranking -> å‰ç«¯ latestPortfolio)
              latestPortfolio.value = data.ranking || []

              // 3. æ›´æ–°è°ƒä»“å»ºè®® (æ•°æ®åº“å­—æ®µ adjustments -> æ‹†åˆ†ä¸º buy/sell)
              const adj = data.adjustments || []

              // è¿‡æ»¤å‡ºä¹°å…¥ (action: 'buy')
              buyList.value = adj
                  .filter((item: any) => item.action === 'buy')
                  .map((item: any) => ({
                      code: item.code,
                      name: item.name,
                      action: 'ä¹°å…¥' // ç”¨äºå‰ç«¯æ˜¾ç¤ºæ–‡å­—
                  }))

              // è¿‡æ»¤å‡ºå–å‡º (action: 'sell')
              sellList.value = adj
                  .filter((item: any) => item.action === 'sell')
                  .map((item: any) => ({
                      code: item.code,
                      name: item.name,
                      action: 'å–å‡º' // ç”¨äºå‰ç«¯æ˜¾ç¤ºæ–‡å­—
                  }))
          } else {
              console.warn('æœªè·å–åˆ°æœ‰æ•ˆæ•°æ®:', res.result.msg)
              formattedDate.value = 'æš‚æ— æ•°æ®'
          }
      } catch (err) {
          console.error('äº‘å‡½æ•°è°ƒç”¨å¤±è´¥', err)
          formattedDate.value = 'æ•°æ®åŠ è½½å¤±è´¥'
      } finally {
          isLoading.value = false
      }
  }

  // --- 4. å›¾è¡¨é€»è¾‘ (ä¿æŒåŸæ ·ï¼Œä¹Ÿå¯ä»¥åç»­æ¢æˆçœŸå®æ•°æ®) ---
  const chartContainer = ref<HTMLElement | null>(null)
  let myChart: echarts.ECharts | null = null

  const initChart = (dates: any, strategyData: any, benchmarkData: any) => {
      if (!chartContainer.value) return
      myChart = echarts.init(chartContainer.value)

      const option = {
          backgroundColor: 'transparent',
          tooltip: { trigger: 'axis' },
          grid: { top: '15%', left: '3%', right: '4%', bottom: '10%', containLabel: true },
          legend: { data: ['å¾®ç›˜è‚¡ç­–ç•¥', 'æ²ªæ·±300'], textStyle: { color: '#b0c4de' }, top: 0 },
          xAxis: {
              type: 'category',
              data: dates,
              axisLine: { lineStyle: { color: '#8392A5' } },
              axisLabel: { show: false }
          },
          yAxis: {
              type: 'value',
              splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
              axisLabel: { color: '#8392A5' },
              scale: true
          },
          series: [
              {
                  name: 'å¾®ç›˜è‚¡ç­–ç•¥',
                  type: 'line',
                  data: strategyData,
                  itemStyle: { color: '#f0e68c' },
                  showSymbol: false,
                  lineStyle: { width: 2 }
              },
              {
                  name: 'æ²ªæ·±300',
                  type: 'line',
                  data: benchmarkData,
                  itemStyle: { color: '#5470c6' },
                  showSymbol: false,
                  lineStyle: { width: 1, type: 'dashed' },
                  areaStyle: { opacity: 0.1, color: '#5470c6' }
              }
          ]
      }
      myChart.setOption(option)
  }

  // --- 5. çƒ­åŠ›å›¾ä¸è¾…åŠ©æ•°æ® (ä¿æŒåŸæ ·) ---
  const monthlyReturns = ref([
      {
          year: 2025,
          months: [-0.1, 12.9, -1.8, 0.4, 10.3, 10.3, 7.7, 1.2, 5.5, 7.7, 5.1, -2.3],
          total: 72.1
      },
      {
          year: 2024,
          months: [0.2, -4.9, 17.1, 0.3, 1.5, -11, 10.6, 4.7, 26, 15.6, 12.4, -9.7],
          total: 73.1
      },
      {
          year: 2023,
          months: [0, 5, -4.1, 0.1, 4.2, 5.9, 10.5, 1.6, 3.4, 2.5, 6.9, 1.8],
          total: 44.1
      },
      {
          year: 2022,
          months: [0, 9.2, 5.6, -0.7, 13.3, 6.2, 10.1, 2.9, -6.1, 5.2, 12.2, -5.2],
          total: 63.9
      },
      {
          year: 2021,
          months: [0.2, 9.5, 8.8, -0.2, 10.5, 5.3, -1.3, 8.9, 0, -2.9, 12.7, 8.7],
          total: 77.2
      },
      {
          year: 2020,
          months: [0.2, 15.3, 3.8, -0.5, 3.3, 2.7, 11.2, 8.6, -3.6, 0.2, 5.9, -7.9],
          total: 44.2
      },
      {
          year: 2019,
          months: [0, 23.1, 13.5, 0.6, 6.4, 5, 1.8, -2.5, 3.3, 3, -2.9, 9],
          total: 75.6
      },
      {
          year: 2018,
          months: [0, -7.3, 13.6, -0.1, 2, -12.8, 6, -6.7, 2.2, -1.6, 13.3, -3.5],
          total: 1.8
      },
      {
          year: 2017,
          months: [0.2, 4.6, -6.3, -0.3, -7.6, 2.5, -7.5, 12.6, 0.5, 0.1, -6.9, -2.8],
          total: -12.1
      },
      {
          year: 2016,
          months: [-1.5, 1.8, 29, -0.2, -1.2, 7.2, -1.9, 8.7, 6.4, 4.3, 6.4, 4.2],
          total: 79.5
      },
      {
          year: 2015,
          months: [0.2, 8.3, 27.7, 0, 44.2, -2, -15.2, -5.8, 1.8, 29.9, 23.9, 20.9],
          total: 209.6
      },
      {
          year: 2014,
          months: [-0.5, 6.7, 1.8, -0.4, 5.4, 9.6, 12.6, 11.6, 20.8, 2, 5.8, -13.2],
          total: 76.8
      },
      {
          year: 2013,
          months: [0.3, 7.1, -3.8, -0.3, 19.1, -12.8, 14.3, 11.1, 6.8, 0.2, 14.2, -1.1],
          total: 64.1
      }
  ])

  const getHeatmapStyle = (value: number | null) => {
      if (value === null || value === undefined) return {}
      if (value === 0) return { backgroundColor: 'transparent' }
      if (value > 0) {
          const opacity = Math.min(Math.abs(value) / 15, 1)
          return {
              backgroundColor: `rgba(255, 87, 34, ${0.2 + opacity * 0.8})`,
              color: '#fff',
              fontWeight: value > 10 ? 'bold' : 'normal'
          }
      } else {
          const opacity = Math.min(Math.abs(value) / 15, 1)
          return {
              backgroundColor: `rgba(0, 196, 151, ${0.2 + opacity * 0.8})`,
              color: '#fff',
              fontWeight: value < -10 ? 'bold' : 'normal'
          }
      }
  }

  const getValueColorClass = (val: number) => {
      if (val > 0) return 'text-red'
      if (val < 0) return 'text-green'
      return ''
  }

  // --- FAQ & é£é™©æ•°æ® (ä¿æŒä¸å˜) ---
  const drawdownDist = ref([
      { range: '0%~10%', count: 193 },
      { range: '10%~20%', count: 11 },
      { range: '20%~30%', count: 1 },
      { range: '30%~40%', count: 2 },
      { range: '40%~50%', count: 0 },
      { range: '>50%', count: 1 }
  ])
  const topDrawdowns = ref([
      {
          start: '2015-06-12',
          trough: '2015-07-08',
          end: '2015-11-24',
          maxDd: -50.9,
          ddDays: 26,
          recDays: 139
      },
      {
          start: '2017-03-20',
          trough: '2018-10-18',
          end: '2019-02-25',
          maxDd: -33.9,
          ddDays: 577,
          recDays: 130
      },
      {
          start: '2024-01-31',
          trough: '2024-02-07',
          end: '2024-02-27',
          maxDd: -33.7,
          ddDays: 7,
          recDays: 20
      },
      {
          start: '2024-05-17',
          trough: '2024-06-06',
          end: '2024-09-24',
          maxDd: -21.2,
          ddDays: 20,
          recDays: 110
      },
      {
          start: '2024-12-12',
          trough: '2025-01-02',
          end: '2025-03-18',
          maxDd: -18.1,
          ddDays: 21,
          recDays: 75
      },
      {
          start: '2020-09-08',
          trough: '2021-02-08',
          end: '2021-03-01',
          maxDd: -17.1,
          ddDays: 153,
          recDays: 21
      },
      {
          start: '2016-02-24',
          trough: '2016-02-29',
          end: '2016-03-18',
          maxDd: -15.5,
          ddDays: 5,
          recDays: 18
      },
      {
          start: '2014-11-28',
          trough: '2014-12-23',
          end: '2015-03-09',
          maxDd: -14.9,
          ddDays: 25,
          recDays: 76
      },
      {
          start: '2016-05-05',
          trough: '2016-05-18',
          end: '2016-06-28',
          maxDd: -14.4,
          ddDays: 13,
          recDays: 41
      },
      {
          start: '2013-05-30',
          trough: '2013-06-25',
          end: '2013-08-01',
          maxDd: -13.2,
          ddDays: 26,
          recDays: 37
      }
  ])
  const openFaqIndex = ref<number | null>(0)
  const toggleFaq = (index: number) => {
      openFaqIndex.value = openFaqIndex.value === index ? null : index
  }
  const faqList = ref([
      {
          question: 'æˆ‘å¦‚ä½•å‚ä¸è¯¥ç­–ç•¥ï¼Ÿ',
          answer: 'æœ¬ç­–ç•¥ç²¾é€‰æ²ªæ·±ä¸»æ¿10åªå°å¸‚å€¼ä¸ªè‚¡ï¼Œæ— ç§‘åˆ›/åˆ›ä¸šæ¿é—¨æ§›ï¼Œä½†è¯·åŠ¡å¿…è®¤çŸ¥å…¶é«˜æ³¢åŠ¨é£é™©ã€‚é¦–æ¬¡å»ºä»“å»ºè®®åœ¨å‘¨ä¸€ä¸Šåˆ9:30è¿›è¡Œï¼›åç»­è¯·ä¸¥æ ¼è·Ÿéšä¿¡å·ï¼ŒåŠ¡å¿…åœ¨å‘¨ä¸€9:30ç¬¬ä¸€æ—¶é—´å®Œæˆè°ƒä»“ï¼Œä»¥å‡å°‘å› è‚¡ä»·å¿«é€Ÿæ³¢åŠ¨å¸¦æ¥çš„æ»‘ç‚¹æŸè€—ã€‚'
      },
      {
          question: '10æ”¯è‚¡ç¥¨æˆ‘åº”è¯¥å¦‚ä½•åˆ†é…èµ„é‡‘ï¼Ÿ',
          answer: 'å»ºè®®ä¸¥æ ¼é‡‡å–â€œç­‰æƒé…ç½®â€åŸåˆ™ã€‚æ— è®ºä¸Šå‘¨ä¸ªè‚¡æ¶¨è·Œå¦‚ä½•ï¼Œåœ¨æ¯æ¬¡è°ƒä»“å®Œæˆåï¼Œè¯·åŠ¡å¿…é€šè¿‡ä¹°å–æ“ä½œï¼Œå°†è¿™10åªè‚¡ç¥¨çš„æŒä»“å¸‚å€¼è°ƒæ•´è‡³å¤§è‡´ç›¸ç­‰ï¼Œå³æ¯åªè‚¡ç¥¨å„å ç­–ç•¥æ€»ä»“ä½çš„10%ã€‚è¿™ç§å®šæœŸçš„â€œå†å¹³è¡¡â€æœ‰åŠ©äºè¢«åŠ¨å®ç°é«˜æŠ›ä½å¸ï¼Œç»´æŒç»„åˆé£é™©å‡è¡¡ã€‚'
      },
      {
          question: 'ä¸ºä½•å›æµ‹ä¸­1æœˆå’Œ4æœˆçš„æ”¶ç›Šè¡¨ç°ç‰¹æ®Šï¼Ÿ',
          answer: 'è¿™æ˜¯ç­–ç•¥ä¸»åŠ¨è§„é¿å¾®ç›˜è‚¡â€œæ—¥å†æ•ˆåº”â€çš„ç»“æœã€‚1æœˆé¢ä¸´å¹´å…³æµåŠ¨æ€§æ”¶ç´§ï¼Œ4æœˆå­˜åœ¨è´¢æŠ¥å­£æš´é›·é£é™©ï¼Œå› æ­¤æ¨¡å‹è®¾å®šäº†ç©ºä»“é¿é™©æœºåˆ¶ã€‚è¡¨æ ¼ä¸­çš„å¾®å°æ•°å€¼æ˜¯æœˆåˆæ¸…ä»“ç¬é—´äº§ç”Ÿçš„æ³¢åŠ¨ï¼Œå®ç›˜æ“ä½œä¸­å»ºè®®æŠ•èµ„è€…æ ¹æ®æƒ…å†µçµæ´»æå‰ç©ºä»“è§‚æœ›ã€‚'
      },
      {
          question: 'æˆ‘åº”è¯¥é…ç½®å¤šå°‘æ¯”ä¾‹ï¼Ÿ',
          answer: 'å¾®ç›˜è‚¡å±äºé«˜é£é™©ã€é«˜å¼¹æ€§çš„è¿›æ”»å‹ç­–ç•¥ï¼Œæ—¨åœ¨åšå–Alphaè¶…é¢æ”¶ç›Šã€‚ä½†è¯¥ç­–ç•¥å¯¹æµåŠ¨æ€§æå…¶æ•æ„Ÿï¼Œè‹¥é‡å¸‚åœºé»‘å¤©é¹…æˆ–èµ„é‡‘é¢æ”¶ç´§ï¼Œå‡€å€¼æ³¢åŠ¨å°†æ˜¾è‘—æ”¾å¤§ã€‚å› æ­¤ï¼Œå»ºè®®å°†å…¶ä½œä¸ºæŠ•èµ„ç»„åˆä¸­çš„â€œå«æ˜Ÿèµ„äº§â€ï¼Œé…ç½®æ¯”ä¾‹ä¸¥æ ¼æ§åˆ¶åœ¨20%ä»¥å†…ï¼Œä»¥å¹³è¡¡æ•´ä½“é£é™©ã€‚'
      }
  ])

  const getlocalData = () => {
      axios.get('./static/microCapData.json').then(res => {
          const data = res.data
          initChart(data.dateList, data.strategyData, data.hs300)
      })
  }
  getlocalData()

  // --- ç”Ÿå‘½å‘¨æœŸ ---
  onMounted(() => {
      fetchStrategyData() // 1. è·å–çœŸå®æ•°æ®
      nextTick(() => {
          // 2. åˆå§‹åŒ–å›¾è¡¨
          window.addEventListener('resize', () => myChart?.resize())
      })
  })
</script>

<style scoped>
  /* =========================================
                                                                  å…¨å±€ä¸åŸºç¡€æ ·å¼ (Theme: #f0e68c / Khaki)
                                                                  ========================================= */
  :global(body),
  :global(html) {
      overflow-x: hidden;
      margin: 0;
      padding: 0;
  }

  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(20px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }
  .page-wrapper {
      font-family: 'Noto Sans SC', sans-serif;
      background-color: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 3rem 1rem;
      /* å¾®ç›˜è‚¡ä¸»é¢˜è‰²èƒŒæ™¯æ¸å˜ */
      background: radial-gradient(circle at 15% 50%, #4a4a2a, transparent 40%),
          radial-gradient(circle at 85% 50%, #4a4a2a, transparent 40%), #121212;
  }

  .main-container {
      max-width: 900px;
      margin: 0 auto;
  }

  /* é¡µé¢å¤´éƒ¨ */
  .page-header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.5s ease-out forwards;
  }

  .back-button {
      color: #b0c4de;
      text-decoration: none;
      font-size: 0.9rem;
      margin-bottom: 1rem;
      display: inline-block;
  }

  .back-button:hover {
      color: #f0e68c;
  }

  .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
  }

  .title-icon {
      font-size: 2.8rem;
      color: #f0e68c;
      text-shadow: 0 0 15px #f0e68c;
  }

  .subtitle {
      font-size: 1.1rem;
      color: #b0c4de;
  }

  /* å†…å®¹å¡ç‰‡ */
  .content-grid {
      display: grid;
      gap: 1.5rem;
  }

  .content-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem 2rem;
      backdrop-filter: blur(10px);
      animation: fadeInUp 0.5s ease-out forwards;
      min-width: 0;
  }

  .content-card:hover {
      border-color: rgba(240, 230, 140, 0.5); /* Theme color hover */
  }

  .card-title {
      font-size: 1.4rem;
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 1rem;
      border-left: 4px solid #f0e68c; /* Theme border */
      padding-left: 1rem;
      color: #fff;
  }

  .card-title.no-margin {
      margin-bottom: 0;
  }

  .card-title.no-border {
      border-left: none;
      padding-left: 0;
  }

  .card-description {
      font-size: 0.95rem;
      color: #b0c4de;
      line-height: 1.8;
      margin-bottom: 1rem;
  }

  .idea-list {
      list-style-type: none;
      padding-left: 1.5rem;
      color: #b0c4de;
      line-height: 1.8;
  }

  .idea-list li {
      position: relative;
      margin-bottom: 0.5rem;
  }

  .idea-list li::before {
      content: 'âœ”';
      position: absolute;
      left: -1.5rem;
      color: #f0e68c;
  }

  /* é£é™©å¡ç‰‡ç‰¹æ®Šæ ·å¼ */
  .risk-warning-card {
      border-left-color: #dc3545;
  }
  .risk-warning-card .card-title {
      border-left-color: #dc3545;
      color: #e24141;
  }

  /* =========================================
                                                                                                                                                             æ–°å¢æ¨¡å—æ ·å¼ï¼šæœ€æ–°æŒä»“ä¸è°ƒä»“
                                                                                                                                                             ========================================= */
  .card-subtitle {
      font-size: 1.1rem;
      font-weight: bold;
      color: #ffffff;
      margin-top: 2rem;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .table-wrapper {
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
  }

  /* .data-table {
                                                                                                  width: 100%;
                                                                                                  border-collapse: collapse;
                                                                                                  min-width: 600px;
                                                                                                  table-layout: fixed;
                                                                                              }

                                                                                              .data-table th,
                                                                                              .data-table td {
                                                                                                  padding: 0.8rem 1rem;
                                                                                                  text-align: left;
                                                                                                  border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                                                                                              }

                                                                                              .data-table th {
                                                                                                  color: #ffffff;
                                                                                                  font-weight: bold;
                                                                                                  border-bottom: 2px solid rgba(255, 255, 255, 0.1);
                                                                                                  white-space: nowrap;
                                                                                              } */

  .data-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 0;
  }

  .data-table th {
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      font-weight: bold;
      padding: 0.8rem;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      white-space: nowrap;
  }

  .data-table td {
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.8rem;
      text-align: center;
      color: #b0c4de;
      font-size: 0.9rem;
      white-space: nowrap;
  }

  .data-table td {
      color: #b0c4de;
  }

  .code-font {
      /* font-family: 'Roboto Mono', monospace; */
      opacity: 1;
  }

  .text-red {
      color: #ff5722 !important;
  }
  .text-green {
      color: #00c497 !important;
  }

  /* è°ƒä»“æŒ‡å¼• Grid */
  .adjustments-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
      margin-bottom: 1rem;
  }

  .adjustment-title {
      font-size: 1rem;
      margin: 0 0 0.8rem 0;
      font-weight: 600;
  }
  .adjustment-title.buy {
      color: #00c497;
  }
  .adjustment-title.sell {
      color: #ff5722;
  }

  .adjustment-list {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
  }

  .adjustment-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      padding: 0.5rem 0.8rem;
      border-radius: 6px;
      font-size: 0.9rem;
      color: #b0c4de;
  }

  .adjustment-item-empty {
      color: #8392a5;
      font-size: 0.9rem;
      padding: 0.5rem 0;
  }

  .action-badge {
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      font-size: 0.8rem;
      font-weight: bold;
      color: #fff;
  }
  .action-badge.buy {
      background-color: rgba(0, 196, 151, 0.7);
  }
  .action-badge.sell {
      background-color: rgba(255, 87, 34, 0.7);
  }

  /* =========================================
                                                                                                                                                             æ–°å¢æ¨¡å—æ ·å¼ï¼šå›¾è¡¨ä¸ç»Ÿè®¡ (Charts & Stats)
                                                                                                                                                             ========================================= */
  .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
  }

  .period-badge {
      font-size: 0.8rem;
      color: #8392a5;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .echart-container {
      width: 100%;
      height: 350px;
      margin-top: 1rem;
  }

  .stats-bar {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      background: rgba(0, 0, 0, 0.2);
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      gap: 1rem;
  }

  .stat-label {
      color: #8392a5;
      font-size: 0.8rem;
      margin-bottom: 0.3rem;
  }

  .stat-value {
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
  }

  .stat-value.highlight {
      color: #f0e68c;
  } /* Yellow for Micro-cap */
  .stat-value.negative {
      color: #00c497;
  }

  /* =========================================
                                                                                                                                                             æ–°å¢æ¨¡å—æ ·å¼ï¼šçƒ­åŠ›å›¾ (Heatmap)
                                                                                                                                                             ========================================= */
  .heatmap-container {
      overflow-x: auto;
  }

  .heatmap-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      min-width: 800px;
  }

  .heatmap-table th {
      padding: 0.8rem 0.2rem;
      font-size: 0.85rem;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.1);
      white-space: nowrap;
  }

  .heatmap-table td {
      padding: 0.6rem 0.2rem;
      text-align: center;
      font-size: 0.85rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .year-col {
      font-weight: bold;
      background: rgba(255, 255, 255, 0.02);
      color: #b0c4de;
  }

  .year-total {
      font-weight: bold;
      color: #fff;
  }

  /* =========================================
                                                                                                                                                             æ–°å¢æ¨¡å—æ ·å¼ï¼šé£é™©åˆ†æ
                                                                                                                                                             ========================================= */
  .risk-summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
  }

  .risk-box {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 1.5rem 1rem;
      border-radius: 8px;
      text-align: center;
  }

  .risk-label {
      font-size: 0.85rem;
      color: #8392a5;
      margin-bottom: 0.5rem;
  }

  .risk-main-val {
      font-size: 1.4rem;
      font-weight: bold;
      color: #f0e68c; /* Theme Yellow */
      margin-bottom: 0.3rem;
  }

  .risk-sub-val {
      font-size: 0.8rem;
      color: #b0c4de;
  }

  /* åˆ†å¸ƒå›¾è¡¨ */
  .dist-table-inner {
      min-width: 600px;
  }

  .dist-header-row,
  .dist-bar-row,
  .dist-label-row {
      display: flex;
      width: 100%;
  }

  .dist-col {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      font-size: 0.8rem;
      color: #8392a5;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
  }
  .dist-col:last-child {
      border-right: none;
  }

  .dist-bar-row {
      height: 40px;
      align-items: center;
      background: rgba(0, 0, 0, 0.2);
  }

  .dist-block.yellow-theme {
      background: linear-gradient(145deg, #f0e68c, #d4c550); /* Yellow Gradient */
      color: #121212;
      font-weight: bold;
      padding: 0.3rem 0;
      border-radius: 4px;
  }

  .risk-table {
      min-width: 700px;
  }

  /* =========================================
                                                                                                                                                             FAQ æ ·å¼
                                                                                                                                                             ========================================= */
  .faq-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
  }

  .faq-item {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .faq-item:last-child {
      border-bottom: none;
  }

  .faq-question {
      width: 100%;
      text-align: left;
      padding: 1rem 0;
      background: none;
      border: none;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .faq-icon {
      font-size: 1.5rem;
      font-weight: bold;
      transition: transform 0.3s ease;
      color: #f0e68c;
  }

  .faq-icon.is-open {
      transform: rotate(45deg);
  }

  .faq-answer {
      padding-bottom: 1rem;
      color: #b0c4de;
      line-height: 1.7;
  }

  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(20px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }
  /* =========================================
                                                                           ç§»åŠ¨ç«¯é€‚é… (æœ€ç»ˆä¿®æ­£ç‰ˆ)
                                                                           ========================================= */
  @media (max-width: 768px) {
      /* 1. æ ¸å¿ƒä¿®å¤ï¼šç»™æ‰€æœ‰æ»šåŠ¨å®¹å™¨æ·»åŠ æ¸å˜é®ç½©ï¼Œå¢åŠ é«˜çº§æ„Ÿ */
      .table-container,
      .table-wrapper,
      .heatmap-container {
          mask-image: linear-gradient(to right, transparent, black 15px, black 95%, transparent);
          -webkit-mask-image: linear-gradient(
              to right,
              transparent,
              black 15px,
              black 95%,
              transparent
          );
      }

      /* 2. é¡µé¢å®¹å™¨è°ƒæ•´ï¼šç¡®ä¿ä¸è¶…å‡ºå±å¹• */
      .page-wrapper {
          padding: 2rem 1rem;
          width: 100vw; /* å¼ºåˆ¶è§†å£å®½åº¦ */
          box-sizing: border-box;
          overflow-x: hidden;
      }

      .main-container {
          width: 100%;
      }

      /* 3. å¤´éƒ¨æ ‡é¢˜é€‚é… */
      .page-header {
          margin-bottom: 2rem;
      }

      .main-title {
          font-size: 2rem;
          gap: 0.8rem;
      }

      .subtitle {
          font-size: 0.95rem;
          padding: 0 1rem; /* å¢åŠ æ–‡å­—å†…è¾¹è·é˜²æ­¢è´´è¾¹ */
      }

      /* 4. å¡ç‰‡é—´è·ä¸æ’ç‰ˆ */
      .content-card {
          padding: 1.5rem 1rem;
      }

      /* 5. ä¿®å¤ï¼šå›¾è¡¨å¤´éƒ¨æ ‡é¢˜å’Œæ—¥æœŸç«–å‘æ’åˆ— */
      .card-header-row {
          flex-direction: column;
          align-items: flex-start;
          gap: 0.8rem;
      }

      .period-badge {
          font-size: 0.75rem;
          align-self: flex-start; /* é å·¦å¯¹é½ */
      }

      /* 6. è°ƒä»“æŒ‡å¼•ï¼šå•åˆ—æ˜¾ç¤º */
      .adjustments-grid {
          grid-template-columns: 1fr;
          gap: 1.5rem;
      }

      /* 7. ç»Ÿè®¡æ¡ï¼šæ”¹ä¸º2åˆ—ç½‘æ ¼ */
      .stats-bar {
          grid-template-columns: repeat(2, 1fr);
          padding: 1rem;
          gap: 1rem;
      }

      /* 8. é£é™©æ•°æ®ï¼šå•åˆ—æ˜¾ç¤º */
      .risk-summary-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
      }

      .risk-box {
          padding: 1.2rem;
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      /* 9. å­—ä½“ä¸ç»†èŠ‚å¾®è°ƒ */
      .faq-question {
          font-size: 0.95rem;
      }

      .data-table,
      .heatmap-table,
      .risk-table,
      .dist-table-inner {
          font-size: 0.85rem;
      }

      /* 10. ä¿®å¤å›æ’¤åˆ†å¸ƒè¡¨çš„å®¹å™¨è¾¹è· */
      .dist-table-container {
          margin-bottom: 0;
          overflow-x: auto;
      }
  }

  /* --- æ–°å¢ï¼šç´§å‡‘å‹è®¡ç®—å™¨å·¥å…·æ¡æ ·å¼ --- */
  .calculator-toolbar {
      background: rgba(0, 0, 0, 0.4);
      border: 1px solid rgba(240, 230, 140, 0.2);
      border-radius: 8px;
      padding: 0.8rem 1rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between; /* ä¸¤ç«¯å¯¹é½ */
      flex-wrap: wrap;
      gap: 1rem;
  }

  .calc-left {
      display: flex;
      align-items: center;
      gap: 0.8rem;
  }

  /* è¾“å…¥æ¡†å®¹å™¨ */
  .input-wrapper {
      position: relative;
      display: flex;
      align-items: center;
  }

  .currency-symbol {
      position: absolute;
      left: 10px;
      color: #f0e68c;
      font-weight: bold;
      font-size: 1rem;
      z-index: 2;
  }

  /* è¾“å…¥æ¡†æ ·å¼ï¼šå˜çŸ­ã€å˜ç²¾è‡´ */
  .compact-input {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: #fff;
      padding: 0.5rem 0.5rem 0.5rem 1.8rem; /* å·¦è¾¹ç•™å‡º Â¥ ç¬¦å·çš„ä½ç½® */
      border-radius: 6px;
      font-size: 1rem;
      width: 140px; /* é™åˆ¶å®½åº¦ */
      outline: none;
      transition: all 0.3s;
  }

  .compact-input:focus {
      border-color: #f0e68c;
      background: rgba(0, 0, 0, 0.3);
  }

  .calc-btn-compact {
      background: #f0e68c;
      color: #121212;
      border: none;
      padding: 0.55rem 1rem;
      border-radius: 6px;
      font-weight: bold;
      cursor: pointer;
      font-size: 0.9rem;
  }
  .calc-btn-compact:hover {
      opacity: 0.9;
  }

  /* è¡Œå†…æ‘˜è¦æ ·å¼ */
  .calc-summary-inline {
      display: flex;
      align-items: center;
      gap: 1.5rem;
      /* background: rgba(255, 255, 255, 0.03); */
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
  }

  .summary-tag {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      line-height: 1.2;
  }

  .summary-tag .label {
      font-size: 0.7rem;
      color: #8392a5;
      margin-bottom: 2px;
  }

  .summary-tag .value {
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
  }

  .summary-tag .value.highlight {
      color: #f0e68c;
  }
  .summary-tag .value.warn {
      color: #ff5722;
  }

  /* è¡¨æ ¼è®¡ç®—åˆ—é«˜äº® */
  .calc-col-head {
      background: rgba(240, 230, 140, 0.15) !important;
      color: #f0e68c !important;
  }
  .calc-col-cell {
      background: rgba(240, 230, 140, 0.03);
  }

  /* ç§»åŠ¨ç«¯é€‚é… */
  @media (max-width: 600px) {
      .calculator-toolbar {
          flex-direction: column;
          align-items: stretch;
      }
      .compact-input {
          width: 100%;
      }
      .calc-summary-inline {
          justify-content: space-between;
      }
  }
</style>