<template>
  <div class="page-wrapper">
    <div class="main-container">

      <div class="page-header">
        <router-link to="/home" class="back-button">
          â† è¿”å›ä¸»é¡µ
        </router-link>

        <h1 class="main-title">
          <span class="title-icon">âš¡</span>
          åŠ¨é‡ç­–ç•¥
        </h1>
        <p class="subtitle">
          è¿½éšè¶‹åŠ¿ï¼Œå¼ºè€…æ’å¼ºã€‚åŸºäºåŠ¨é‡æ¨¡å‹çš„è½®åŠ¨ç³»ç»Ÿã€‚
        </p>
      </div>

      <div class="content-grid">
        <div class="content-card">
          <h2 class="card-title">ç­–ç•¥ç®€ä»‹</h2>
          <p class="card-description">
            åŠ¨é‡ç­–ç•¥ï¼ˆMomentum Strategyï¼‰çš„æ ¸å¿ƒç†å¿µæºäºé‡‘èå¸‚åœºä¸­å¹¿æ³›å­˜åœ¨çš„â€œåŠ¨é‡æ•ˆåº”â€â€”â€”å³è¿‡å»ä¸€æ®µæ—¶é—´è¡¨ç°æœ€å¥½çš„èµ„äº§ï¼Œåœ¨æœªæ¥ä¸€æ®µæ—¶é—´å†…å¾€å¾€èƒ½å»¶ç»­å…¶å¼ºåŠ¿è¡¨ç°ã€‚
          </p>
          <p class="card-description">
            æœ¬ç­–ç•¥ä¸ä¸»è§‚é¢„æµ‹å¸‚åœºæ¶¨è·Œï¼Œè€Œæ˜¯é€šè¿‡é‡åŒ–æ¨¡å‹å®æ—¶ç›‘æ§ <strong>Aè‚¡ä¸»æµé£æ ¼æŒ‡æ•°</strong>ã€<strong>å¢ƒå¤–å®½åŸºæŒ‡æ•°</strong> ä»¥åŠ <strong>é»„é‡‘ETF</strong> çš„è¶‹åŠ¿å¼ºåº¦ã€‚ç³»ç»Ÿæ¯æ—¥è®¡ç®—å„æ ‡çš„çš„
            <strong>è¿‘20æ—¥æ¶¨å¹…</strong>ï¼Œåœ¨ä¸åŒå¸‚åœºç¯å¢ƒå’Œé£é™©åå¥½ä¸‹ï¼ŒåŠ¨æ€è½®åŠ¨æŒæœ‰å½“å‰å¸‚åœºä¸­â€œæœ€å¼ºâ€çš„æ ‡çš„ã€‚
          </p>
        </div>

        <div class="content-card">
          <h2 class="card-title">ç»„åˆæ€æƒ³</h2>
          <ul class="idea-list">
            <li><b>é£æ ¼äº’è¡¥ (Style Diversification) â‡’</b> Aè‚¡å¸‚åœºå†…ä¸å­˜åœ¨å•ä¸€çš„å¸¸èƒœé£æ ¼ã€‚æˆ‘ä»¬åœ¨æˆé•¿ä¸ä»·å€¼æŒ‡æ•°é—´åŠ¨æ€è½®åŠ¨ï¼Œç¡®ä¿æ•è·ç»“æ„æ€§ä¸Šæ¶¨æœºä¼šã€‚</li>
            <li><b>å…¨çƒè§†é‡ (Global Allocation) â‡’</b> å½“Aè‚¡é¢ä¸´ç³»ç»Ÿæ€§è°ƒæ•´æˆ–é£æ ¼å¤±æ•ˆæ—¶ï¼Œç­–ç•¥è‡ªåŠ¨åˆ‡æ¢è‡³èµ°åŠ¿æ›´å¼ºçš„å¢ƒå¤–ä¸»æµæŒ‡æ•°ï¼Œåˆ©ç”¨è·¨å¸‚åœºä½ç›¸å…³æ€§æä¾›ä¿æŠ¤ã€‚</li>
            <li><b>é¿é™©å…œåº• (Safe Haven Anchor) â‡’</b> é»„é‡‘æ˜¯æœ€åçš„é˜²çº¿ã€‚å½“å…¨çƒæƒç›Šå¸‚åœºé™·å…¥ææ…Œæ—¶ï¼Œç­–ç•¥å°†â€œç»ˆæåº•ç‰Œâ€åˆ‡æ¢è‡³é»„é‡‘ï¼Œç¡®ä¿æç«¯è¡Œæƒ…ä¸‹çš„èµ„äº§å®‰å…¨ã€‚</li>
          </ul>
        </div>

        <div class="content-card monitor-card">
          <div class="card-header-row monitor-header">
            <h2 class="card-title no-margin">åŠ¨é‡ç›‘æ§</h2>

            <div class="monitor-meta">
              <div class="system-status">
                <span class="status-dot"></span>
                <span class="status-text">ä¿¡å·æ›´æ–°: {{ signalUpdateTime }}</span>
              </div>

              <!-- <div class="signal-tag">
                <span class="icon">ğŸ””</span> ç­–ç•¥ä¿¡å·
              </div> -->
            </div>
          </div>

          <div class="dashboard-grid">
            <div class="dash-item date-box">
              <div class="dash-label">ğŸ“… æœ¬æœŸè°ƒä»“æ—¥</div>
              <div class="dash-value">{{ currentRebalanceDate }} <span v-if='isToday'>(ä»Šå¤©)</span> </div>
              <div class="dash-sub">äº¤æ˜“æ—¥ä¸‹åˆ2:50ç¡®è®¤ä¿¡å·</div>
            </div>
            <div class="dash-item holding-box">
              <div class="dash-label">ğŸ¯ å½“å‰å¼ºåŠ¨é‡æŒä»“</div>
              <div class="dash-value highlight">{{ currentHolding }}</div>
              <div class="dash-sub">è½®åŠ¨ä»£ç : {{currentHoldingCode}}</div>
            </div>
          </div>

          <div class="section-divider"></div>

          <div class="data-section-header">
            <div class="section-title">
              å®æ—¶æ¶¨å¹…æ’å
              <span class="desc-text">(è¿‘20æ—¥æ¶¨å¹…)</span>
            </div>
            <div class="system-status">
              <span class="status-dot"></span>
              <span class="status-text">æ•°æ®æ›´æ–°: {{ dataUpdateTime }}</span>
            </div>
          </div>

          <div class="table-container">
            <table class="momentum-table">
              <thead>
                <tr>
                  <th width="10%">æ’å</th>
                  <th>ETFåç§°</th>
                  <th>ä»£ç </th>
                  <th>è¿½è¸ªæŒ‡æ•°</th>
                  <th width="20%">è¿‘20æ—¥æ¶¨å¹…</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="(item, index) in momentumList" :key="item.code" :class="{'active-row': index === 0}">
                  <td>
                    <span :class="['rank-badge', 'rank-' + (Number(index) + 1)]">{{ Number(index) + 1 }}</span>
                  </td>
                  <td class="name-col">{{ item.name }}</td>
                  <td class="code-col">{{ item.code }}</td>
                  <td class="index-col">{{ item.indexName }}</td>
                  <td :class="['growth-col', getValueColorClass(item.ratio)]">
                    {{ item.ratio > 0 ? '+' : '' }}{{ item.ratio.toFixed(2) }}%
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="content-card">
          <div class="card-header-row">
            <h2 class="card-title no-margin">åŠ¨é‡ç­–ç•¥ vs æ²ªæ·±300å…¨æ”¶ç›Š</h2>
            <span class="period-badge">å›æµ‹å‘¨æœŸ: 2012-12-31 è‡³ 2025-12-31</span>
          </div>

          <div ref="chartContainer" class="echart-container"></div>

          <div class="stats-bar">
            <div class="stat-item">
              <div class="stat-label">æ€»æ”¶ç›Š</div>
              <div class="stat-value highlight">5200.43%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">å¹´åŒ–æ”¶ç›Š</div>
              <div class="stat-value">37.28%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">æ³¢åŠ¨ç‡</div>
              <div class="stat-value">24.61%</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">å¤æ™®æ¯”ç‡</div>
              <div class="stat-value">1.43</div>
            </div>
            <div class="stat-item">
              <div class="stat-label">æœ€å¤§å›æ’¤</div>
              <div class="stat-value negative">29.72%</div>
            </div>
          </div>
        </div>

        <div class="content-card">
          <h2 class="card-title">ç­–ç•¥æœˆåº¦/å¹´åº¦æ”¶ç›Šè¡¨</h2>
          <div class="table-container heatmap-container">
            <table class="heatmap-table">
              <thead>
                <tr>
                  <th>å¹´ä»½</th>
                  <th v-for="m in 12" :key="m">{{ m }}æœˆ</th>
                  <th>å¹´åº¦</th>
                </tr>
              </thead>
              <tbody>
                <tr v-for="yearData in monthlyReturns" :key="yearData.year">
                  <td class="year-col">{{ yearData.year }}</td>
                  <td v-for="(val, idx) in yearData.months" :key="idx" :style="getHeatmapStyle(val)" class="cell-val">
                    {{ val !== null ? val + '%' : '' }}
                  </td>
                  <td class="year-total" :style="getHeatmapStyle(yearData.total)">
                    {{ yearData.total }}%
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="content-card">
          <h2 class="card-title"> æ·±åº¦é£é™©åˆ†æ</h2>

          <div class="risk-summary-grid">
            <div class="risk-box">
              <div class="risk-label">å¡ç›æ¯”ç‡ (Calmar)</div>
              <div class="risk-main-val">1.25</div>
              <div class="risk-sub-val">å¹´åŒ–æ”¶ç›Š / æœ€å¤§å›æ’¤</div>
            </div>
            <div class="risk-box">
              <div class="risk-label">ç›ˆåˆ© / æ€»æœˆæ•°</div>
              <div class="risk-main-val"> 95/ 156</div>
              <div class="risk-sub-val">æœˆåº¦èƒœç‡: 60.9%</div>
            </div>
            <div class="risk-box">
              <div class="risk-label">å¹³å‡æŒä»“å¤©æ•°</div>
              <div class="risk-main-val">5.4 å¤©</div>
              <div class="risk-sub-val">åæ˜ ç­–ç•¥æ¢æ‰‹é¢‘ç‡</div>
            </div>
          </div>

          <h3 class="sub-title"> å›æ’¤æ·±åº¦åˆ†å¸ƒ (é¢‘ç‡ç»Ÿè®¡)</h3>
          <div class="table-container dist-table-container">
            <div class="dist-table-inner">
              <div class="dist-header-row">
                <div class="dist-col" v-for="item in drawdownDist" :key="item.range">{{ item.range }}</div>
              </div>
              <div class="dist-bar-row">
                <div class="dist-col" v-for="item in drawdownDist" :key="item.range">
                  <div class="dist-block teal-theme">
                    {{ item.count }}
                  </div>
                </div>
              </div>
              <div class="dist-label-row">
                <div class="dist-col">æ¬¡æ•°</div>
              </div>
            </div>
          </div>

          <h3 class="sub-title" style="margin-top: 2rem;"> å†å²é‡å¤§å›æ’¤æ˜ç»† (Top 10)</h3>
          <div class="table-container">
            <table class="risk-table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>å¼€å§‹æ—¥æœŸ</th>
                  <th>è°·åº•æ—¥æœŸ</th>
                  <th>æ¢å¤æ—¥æœŸ</th>
                  <th>æœ€å¤§å›æ’¤</th>
                  <th>å›æ’¤æœŸ(å¤©)</th>
                  <th>ä¿®å¤æœŸ(å¤©)</th>

                </tr>
              </thead>
              <tbody>
                <tr v-for="(item, index) in topDrawdowns" :key="index">
                  <td>{{ index + 1 }}</td>
                  <td>{{ item.start }}</td>
                  <td>{{ item.trough }}</td>
                  <td>{{ item.end }}</td>
                  <td class="negative">{{ item.maxDd }}%</td>
                  <td>{{ item.ddDays }}</td>
                  <td>{{ item.recDays }}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <div class="content-card">
          <h2 class="card-title">å¸¸è§é—®é¢˜ (FAQ)</h2>
          <div class="faq-container">
            <div v-for="(item, index) in faqList" :key="index" class="faq-item">
              <button class="faq-question" @click="toggleFaq(index)">
                <span>{{ item.question }}</span>
                <span :class="['faq-icon', { 'is-open': openFaqIndex === index }]">+</span>
              </button>
              <div v-if="openFaqIndex === index" class="faq-answer">
                <p>{{ item.answer }}</p>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</template>

<script setup lang="ts">
  import { ref, onMounted, nextTick } from 'vue'
  import * as echarts from 'echarts'
  import app, { auth } from '@/lib/cloudbase'
  import axios from 'axios'
  // --- 1. åŠ¨é‡ç›‘æ§å°æ•°æ® ---
  const currentRebalanceDate = ref('')
  const dataUpdateTime = ref('')
  const signalUpdateTime = ref('')
  const currentHolding = ref('')
  const currentHoldingCode = ref('')
  const isToday = ref(false)

  const momentumList: any = ref([])

  const getMomentum = () => {
      app.callFunction({
          name: 'getMomentumInfo',
          parse: true
      }).then((res: any) => {
          // ç›´æ¥ä½¿ç”¨ä»äº‘å‡½æ•°è¿”å›çš„ç»“æœ
          const data: any = res.result.data
          signalUpdateTime.value = data.updated_at
          currentRebalanceDate.value = data.switch_date
          currentHolding.value = data.top_1_name
          currentHoldingCode.value = data.top_1_code
          isToday.value = data.is_switch_triggered
      })
  }
  getMomentum()

  const getEtfData = () => {
      app.callFunction({
          name: 'fetchEtfData',
          parse: true
      }).then((res: any) => {
          console.log(res)
          momentumList.value = res.result.list
          dataUpdateTime.value = res.result.updateTime
      })
  }
  getEtfData()

  const getlocalData = () => {
      axios.get('./static/momentumData.json').then(res => {
          const data = res.data
          initChart(data.dateList, data.strategyData, data.hs300)
      })
  }
  getlocalData()
  // --- 2. æ”¶ç›Šçƒ­åŠ›å›¾æ•°æ® ---
  const monthlyReturns: any = ref([])
  const generateMockData = () => {
      const years = [
          {
              year: 2025,
              months: [0.2, -2, 4.6, 6.8, 1.3, 7.3, 2.8, 26, 6.2, -2.5, -4.7, 2.7],
              total: 56.5
          },
          {
              year: 2024,
              months: [-2, 4.1, 6.9, 5.4, -1.5, -0.5, 2.1, -3.1, 34.8, -0.5, -11.9, -2.6],
              total: 28.3
          },
          {
              year: 2023,
              months: [4.9, -1.9, -0.9, 0.8, 5.1, 6.5, 2.9, -3.1, -1, 0, 0.2, 5.5],
              total: 20.1
          },
          {
              year: 2022,
              months: [-3.3, 3.4, -0.8, -15.4, -0.5, 16.9, 7.3, -3.8, 0.8, -4.1, -0.6, -6.9],
              total: -10
          },
          {
              year: 2021,
              months: [8.9, -3.1, 4.6, 10.2, 8.8, 5.3, 14.7, 3.5, 1.4, 0.3, 0.8, 1.1],
              total: 71.7
          },
          {
              year: 2020,
              months: [4.5, 0.8, -9.3, 10.5, -3.8, 11.6, 16.2, 2.3, -14.8, -9.3, 7.8, -2.8],
              total: 9.1
          },
          {
              year: 2019,
              months: [3, 14.9, 11.8, 2.5, -4.1, 8.1, -3.4, 8.8, -4.5, 3.5, 4.7, 3.5],
              total: 58.2
          },
          {
              year: 2018,
              months: [6.3, -8.1, 2.9, -5, 3, 1, 2.1, 4.5, -2.9, -1.6, 0, -5.6],
              total: -4.3
          },
          {
              year: 2017,
              months: [4.9, 3.5, 1, 3.2, 3.7, 5.8, 5.5, -2, 1.2, 3.7, 0.6, -0.5],
              total: 35.1
          },
          {
              year: 2016,
              months: [6.1, 9.4, 3.1, -2.1, -2, -2.2, 5.1, 2.3, -2.1, -1.9, 1, -2.6],
              total: 14.1
          },
          {
              year: 2015,
              months: [-6.9, 14.7, 19.6, 32.6, 20.2, 2, -1, 8.3, 1.2, 19, 8.3, -2.7],
              total: 182.8
          },
          {
              year: 2014,
              months: [14.7, -2.1, -1.9, -0.2, 0.6, 5.5, 3.7, 2.4, 9.3, -0.6, 9.7, 20.7],
              total: 78.3
          },
          {
              year: 2013,
              months: [0, 11, -1.6, -6.1, 20.3, -5.9, -1.4, -3, 5.6, -3.3, 7.6, -9.1],
              total: 10.8
          }
      ]
      // console.log(years)
      monthlyReturns.value = years
  }
  generateMockData()

  const getHeatmapStyle = (value: number | null) => {
      if (value === null || value === undefined) return {}
      if (value === 0) return { backgroundColor: 'transparent' }
      if (value > 0) {
          const opacity = Math.min(Math.abs(value) / 10, 1)
          return {
              backgroundColor: `rgba(255, 87, 34, ${0.15 + opacity * 0.7})`,
              color: '#fff',
              fontWeight: value > 10 ? 'bold' : 'normal'
          }
      } else {
          const opacity = Math.min(Math.abs(value) / 10, 1)
          return {
              backgroundColor: `rgba(0, 196, 151, ${0.15 + opacity * 0.7})`,
              color: '#fff',
              fontWeight: value < -10 ? 'bold' : 'normal'
          }
      }
  }

  const getValueColorClass = (val: number) => {
      if (val > 0) return 'text-red'
      if (val < 0) return 'text-green'
      return ''
  }

  // --- 3. é£é™©æ•°æ® ---
  const drawdownDist = ref([
      { range: '0% ~ 5%', count: 81 },
      { range: '5% ~ 10%', count: 15 },
      { range: '10% ~ 15%', count: 8 },
      { range: '15% ~ 20%', count: 4 },
      { range: '20% ~ 25%', count: 2 },
      { range: '25% ~ 30%', count: 2 },
      { range: '> 30%', count: 0 }
  ])

  const topDrawdowns = ref([
      {
          start: '2024-10-08',
          trough: '2025-01-02',
          end: '2025-08-22',
          maxDd: -29.72,
          ddDays: 86,
          recDays: 232
      },
      {
          start: '2020-07-14',
          trough: '2020-10-30',
          end: '2021-05-25',
          maxDd: -25.39,
          ddDays: 108,
          recDays: 207
      },
      {
          start: '2021-09-13',
          trough: '2022-05-24',
          end: '2022-08-10',
          maxDd: -24.86,
          ddDays: 253,
          recDays: 78
      },
      {
          start: '2020-02-25',
          trough: '2020-03-19',
          end: '2020-07-02',
          maxDd: -23.36,
          ddDays: 23,
          recDays: 105
      },
      {
          start: '2022-08-15',
          trough: '2023-03-22',
          end: '2024-02-20',
          maxDd: -19.38,
          ddDays: 219,
          recDays: 335
      },
      {
          start: '2018-01-26',
          trough: '2018-03-23',
          end: '2019-02-25',
          maxDd: 15.57,
          ddDays: 56,
          recDays: 339
      },
      {
          start: '2013-05-27',
          trough: '2013-09-12',
          end: '2014-01-24',
          maxDd: -15.29,
          ddDays: 108,
          recDays: 134
      },
      {
          start: '2015-06-12',
          trough: '2015-08-06',
          end: '2015-10-08',
          maxDd: -13.56,
          ddDays: 55,
          recDays: 63
      },
      {
          start: '2020-01-22',
          trough: '2020-02-04',
          end: '2020-02-18',
          maxDd: -13.06,
          ddDays: 13,
          recDays: 14
      },
      {
          start: '2016-04-14',
          trough: '2016-06-21',
          end: '2017-02-21',
          maxDd: '-12.50',
          ddDays: 68,
          recDays: 245
      }
  ])

  // --- 4. FAQ ---
  const openFaqIndex = ref<number | null>(0)
  const toggleFaq = (index: number) => {
      openFaqIndex.value = openFaqIndex.value === index ? null : index
  }
  const faqList = ref([
      {
          question: 'å¦‚ä½•å‚ä¸è¯¥ç­–ç•¥ï¼Ÿæœ€ä½èµ„é‡‘é—¨æ§›æ˜¯å¤šå°‘ï¼Ÿ',
          answer: 'æœ¬ç­–ç•¥å§‹ç»ˆåªæŒæœ‰ä¸€åªæœ€å¼ºçš„ETFã€‚ç”±äºæ ‡çš„å‡ä¸ºETFï¼Œç†è®ºä¸Šåªéœ€â€œä¸€æ‰‹â€ï¼ˆ100è‚¡ï¼‰çš„é‡‘é¢å³å¯å‚ä¸ï¼Œä½†å»ºè®®1000å…ƒèµ·æ­¥ä»¥ä¿è¯èµ„é‡‘åˆ©ç”¨ç‡ã€‚è¯·åœ¨äº¤æ˜“æ—¥14:50ï¼ˆæ”¶ç›˜å‰10åˆ†é’Ÿï¼‰æŸ¥çœ‹ä¿¡å·ï¼šè‹¥æ’åå˜åŒ–åˆ™è¿›è¡Œè½®åŠ¨ï¼ˆå–æ—§ä¹°æ–°ï¼‰ã€‚æ³¨æ„ï¼šç³»ç»Ÿæ¯æ—¥æ›´æ–°æ•°æ®ï¼Œä½†å¹¶éæ¯å¤©éƒ½éœ€è¦è°ƒä»“ã€‚'
      },
      {
          question: 'è¯¥ç­–ç•¥ä¾æ‰˜äºä»€ä¹ˆæ ¸å¿ƒæ€æƒ³ï¼Ÿ',
          answer: 'æˆ‘å–œæ¬¢ç”¨â€œæƒ¯æ€§â€æ¥è§£é‡Šã€‚ä¸‡äº‹ä¸‡ç‰©çš†æœ‰æƒ¯æ€§ï¼Œä¸”åé¦ˆå¾€å¾€æ»åã€‚å¥½æ¯”â€œå¤è‡³â€æ˜¯ä¸€å¹´ä¸­ç™½æ˜¼æœ€é•¿çš„ï¼Œä½†æœ€çƒ­çš„æ—¶å€™å¾€å¾€å‡ºç°åœ¨ä¹‹åçš„â€œå°æš‘â€å’Œâ€œå¤„æš‘â€ã€‚é‡‘èå¸‚åœºäº¦ç„¶ï¼Œä»·æ ¼çš„å¼ºåŠ¿è¡¨ç°å¾€å¾€èƒ½å»¶ç»­ï¼Œæˆ‘ä»¬èµšå–çš„å°±æ˜¯è¿™æ®µæƒ¯æ€§å¸¦æ¥çš„æ”¶ç›Šã€‚'
      },
      {
          question: 'å¦‚æœé”™è¿‡äº†14:50çš„æ“ä½œæ—¶é—´æ€ä¹ˆåŠï¼Ÿ',
          answer: 'æ²¡å…³ç³»ã€‚åŠ¨é‡ç­–ç•¥æ•æ‰çš„æ˜¯ä¸­æœŸè¶‹åŠ¿ï¼Œå¹¶éæ—¥å†…é«˜é¢‘äº¤æ˜“ã€‚å¦‚æœæ‚¨é”™è¿‡äº†æ”¶ç›˜å‰çš„æ“ä½œçª—å£ï¼Œå¯ä»¥åœ¨ç¬¬äºŒä¸ªäº¤æ˜“æ—¥çš„å¼€ç›˜æ—¶å®Œæˆè°ƒä»“ï¼Œé€šå¸¸å¯¹æ•´ä½“æ”¶ç›Šå½±å“ä¸å¤§ã€‚'
      },
      {
          question: 'è¿™ä¸ªç­–ç•¥æœ‰é£é™©å—ï¼Ÿ',
          answer: 'æœ‰ã€‚åŠ¨é‡ç­–ç•¥æœ€æ€•çš„æ˜¯â€œéœ‡è¡å¸‚â€æˆ–â€œå‡çªç ´â€ã€‚å³ä¹°å…¥åè¶‹åŠ¿ç«‹åˆ»åè½¬ï¼Œå¯¼è‡´æˆ‘ä»¬è¦æ­¢æŸå–å‡ºã€‚è¿™æ˜¯ä¸ºäº†æ•æ‰å¤§è¶‹åŠ¿æ‰€å¿…é¡»æ”¯ä»˜çš„â€œä¿é™©è´¹â€ã€‚ä½†é•¿æœŸæ¥çœ‹ï¼Œåªè¦æŠ“ä½å‡ æ¬¡ä¸»å‡æµªï¼Œè¶³ä»¥è¦†ç›–è¿™äº›ç£¨æŸæˆæœ¬ã€‚'
      },
      {
          question: 'æ˜¯å¦æœ‰ç©ºä»“ï¼ˆæŒå¸ï¼‰çš„æ—¶é—´ï¼Ÿ',
          answer: 'åŸåˆ™ä¸Šæ²¡æœ‰ç©ºä»“æœŸã€‚ç­–ç•¥é‡‡ç”¨â€œäº”é€‰ä¸€â€æœºåˆ¶ï¼Œæ ‡çš„æ± å·²åŒ…å«é»„é‡‘ä½œä¸ºç»ˆæé¿é™©èµ„äº§ã€‚å›æµ‹æ•°æ®æ˜¾ç¤ºï¼Œå¼ºåˆ¶å¼•å…¥ç°é‡‘ï¼ˆå¦‚æ¨¡æ‹Ÿ3%æ”¶ç›Šçš„è™šæ‹Ÿå€ºåˆ¸ï¼‰åè€Œä¼šæ‹‰ä½æ•´ä½“æ”¶ç›Šã€‚å› æ­¤ï¼Œå½“è‚¡å¸‚ä½è¿·æ—¶ï¼Œæˆ‘ä»¬ä¼šè‡ªåŠ¨è½®åŠ¨è‡³é»„é‡‘ï¼Œæ—¶åˆ»ä¿æŒåœ¨åœºä»¥æ•æ‰æ‰€æœ‰è¶‹åŠ¿ã€‚'
      }
  ])

  // --- 5. ECharts ---
  const chartContainer = ref<HTMLElement | null>(null)
  let myChart: echarts.ECharts | null = null

  onMounted(() => {
      nextTick(() => {
          getlocalData()
      })
      window.addEventListener('resize', handleResize)
  })

  const handleResize = () => {
      if (myChart) {
          myChart.resize()
      }
  }

  const initChart = (xAxis: any, strategyData: any, hs300: any) => {
      if (!chartContainer.value) return
      myChart = echarts.init(chartContainer.value)
      // const dateList = Array.from(
      //     { length: 100 },
      //     (_, i) => `2024-${Math.floor(i / 30) + 1}-${(i % 30) + 1}`
      // )
      // console.log(dateList)
      // const strategyData = dateList.map((_, i) => 1000 + i * 10 + Math.random() * 50)
      // console.log(strategyData)
      // const indexData = dateList.map((_, i) => 1000 + i * 5 + Math.random() * 100)
      const option = {
          backgroundColor: 'transparent',
          tooltip: { trigger: 'axis' },
          grid: { top: '10%', left: '3%', right: '4%', bottom: '15%', containLabel: true },
          xAxis: { type: 'category', data: xAxis, axisLine: { lineStyle: { color: '#8392A5' } } },
          yAxis: {
              type: 'value',
              splitLine: { lineStyle: { color: 'rgba(255,255,255,0.1)' } },
              axisLabel: { color: '#8392A5' }
          },
          series: [
              {
                  name: 'åŠ¨èƒ½ç­–ç•¥',
                  type: 'line',
                  data: strategyData,
                  itemStyle: { color: '#FF5722' },
                  showSymbol: false,
                  lineStyle: { width: 2 }
              },
              {
                  name: 'æ²ªæ·±300',
                  type: 'line',
                  data: hs300,
                  itemStyle: { color: '#00bcd4' },
                  showSymbol: false,
                  lineStyle: { width: 1, type: 'dashed' }
              }
          ]
      }
      myChart.setOption(option)
  }
</script>

<style scoped>
  /* =========================================
                     1. å…¨å±€ä¸åŸºç¡€åŠ¨ç”»
                     ========================================= */
  :global(body),
  :global(html) {
      overflow-x: hidden;
      margin: 0;
      padding: 0;
  }

  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(20px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  .page-wrapper {
      font-family: 'Noto Sans SC', sans-serif;
      background-color: #121212;
      color: #ffffff;
      min-height: 100vh;
      padding: 3rem 1rem;
      background: radial-gradient(circle at 15% 50%, #2b120a, transparent 40%),
          radial-gradient(circle at 85% 50%, #2b1a0a, transparent 40%), #121212;
      box-sizing: border-box;
  }

  .main-container {
      max-width: 960px;
      margin: 0 auto;
  }

  /* =========================================
                     2. é¡µé¢å¤´éƒ¨ (Header)
                     ========================================= */
  .page-header {
      text-align: center;
      margin-bottom: 3rem;
      animation: fadeInUp 0.5s ease-out forwards;
  }

  .back-button {
      color: #b0c4de;
      text-decoration: none;
      font-size: 0.9rem;
      transition: color 0.3s ease;
      display: inline-block;
      margin-bottom: 1rem;
  }

  .back-button:hover {
      color: #ff5722;
  }

  .main-title {
      font-size: 2.5rem;
      font-weight: 700;
      color: #fff;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 0.5rem;
  }

  .title-icon {
      font-size: 2.8rem;
      text-shadow: 0 0 15px #ff5722;
  }

  .subtitle {
      font-size: 1.1rem;
      color: #b0c4de;
  }

  /* =========================================
                     3. é€šç”¨å†…å®¹å¡ç‰‡ (Content Card)
                     ========================================= */
  .content-grid {
      display: grid;
      gap: 1.5rem;
  }

  .content-card {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 12px;
      padding: 1.5rem 2rem;
      backdrop-filter: blur(10px);
      animation: fadeInUp 0.5s ease-out forwards;
      min-width: 0;
  }

  .content-card:hover {
      border-color: rgba(255, 87, 34, 0.5);
  }

  .card-header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
      gap: 1rem;
  }

  .card-title {
      font-size: 1.4rem;
      font-weight: bold;
      color: #ffffff;
      margin-top: 0;
      margin-bottom: 1rem;
      border-left: 4px solid #ff5722;
      padding-left: 1rem;
  }

  .card-title.no-margin {
      margin-bottom: 0;
  }

  .card-description {
      font-size: 0.95rem;
      color: #b0c4de;
      line-height: 1.7;
      margin-bottom: 1rem;
  }

  .period-badge {
      font-size: 0.8rem;
      color: #8392a5;
      background: rgba(0, 0, 0, 0.3);
      padding: 0.3rem 0.8rem;
      border-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .idea-list {
      list-style-type: none;
      padding-left: 1.5rem;
      color: #b0c4de;
      line-height: 1.8;
  }

  .idea-list li {
      position: relative;
      margin-bottom: 0.5rem;
  }

  .idea-list li::before {
      content: 'âš¡ ';
      color: #ff5722;
      font-weight: bold;
      position: absolute;
      left: -1.5rem;
  }

  /* =========================================
                     4. åŠ¨é‡ç›‘æ§å¡ç‰‡ (Monitor Card) - æ ¸å¿ƒä¿®æ”¹åŒºåŸŸ
                     ========================================= */
  .monitor-card {
      background: linear-gradient(145deg, rgba(255, 87, 34, 0.03), rgba(255, 255, 255, 0.05));
  }

  /* --- 4.1 ç›‘æ§é¡¶éƒ¨æ ‡é¢˜æ  --- */
  .monitor-header {
      margin-bottom: 1rem;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap; /* å…è®¸å°å±å¹•æ¢è¡Œ */
      gap: 0.8rem;
  }

  /* å³ä¾§å…ƒæ•°æ®å®¹å™¨ (æ—¶é—´ + æ ‡ç­¾) */
  .monitor-meta {
      display: flex;
      align-items: center;
      gap: 12px;
  }

  /* ä¿¡å·æ›´æ–°æ—¶é—´ (ç°è‰²æ­»æ—¶é—´) */
  .signal-time {
      font-size: 0.8rem;
      color: #8392a5;
      font-family: 'Roboto Mono', monospace;
      letter-spacing: 0.5px;
  }

  /* ç­–ç•¥ä¿¡å·æ ‡ç­¾ */
  .signal-tag {
      font-size: 0.85rem;
      color: #ff5722;
      background: rgba(255, 87, 34, 0.1);
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      border: 1px solid rgba(255, 87, 34, 0.2);
      display: flex;
      align-items: center;
      gap: 4px;
      white-space: nowrap;
  }

  /* --- 4.2 ä»ªè¡¨ç›˜ Grid --- */
  .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 1rem;
      margin-bottom: 1.5rem;
  }

  .dash-item {
      background: rgba(0, 0, 0, 0.2);
      border: 1px solid rgba(255, 255, 255, 0.08);
      border-radius: 8px;
      padding: 1.2rem;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
  }

  .holding-box {
      background: rgba(255, 87, 34, 0.08);
      border-color: rgba(255, 87, 34, 0.2);
  }

  .dash-label {
      font-size: 0.8rem;
      color: #8392a5;
      margin-bottom: 0.5rem;
  }

  .dash-value {
      font-size: 1.3rem;
      font-weight: bold;
      color: #fff;
      font-family: 'Roboto Mono', monospace;
  }

  .dash-value.highlight {
      color: #ff5722;
      font-size: 1.5rem;
  }

  .dash-sub {
      font-size: 0.8rem;
      color: #bae4f9;
      margin-top: 0.5rem;
  }

  /* --- 4.3 ä¸­é—´åˆ†å‰²çº¿ --- */
  .section-divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
      margin: 1.5rem 0;
      width: 100%;
  }

  /* --- 4.4 æ•°æ®åŒºåŸŸå¤´éƒ¨ --- */
  .data-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1rem;
      flex-wrap: wrap;
      gap: 0.5rem;
  }

  .section-title {
      font-size: 1rem;
      font-weight: bold;
      color: #fff;
      display: flex;
      align-items: center;
      gap: 0.5rem;
  }

  .desc-text {
      font-size: 0.8rem;
      color: #8392a5;
      font-weight: normal;
  }

  /* ä¸‹æ–¹çš„æ•°æ®æ›´æ–°æ—¶é—´èƒ¶å›Š */
  .system-status {
      display: flex;
      align-items: center;
      font-size: 0.75rem;
      color: #8392a5;
      background: rgba(0, 0, 0, 0.2);
      padding: 0.2rem 0.6rem;
      border-radius: 4px;
      border: 1px solid rgba(255, 255, 255, 0.05);
  }

  .status-dot {
      width: 6px;
      height: 6px;
      background: #00c497;
      border-radius: 50%;
      margin-right: 6px;
      box-shadow: 0 0 5px #00c497;
  }

  /* =========================================
                     5. è¡¨æ ¼ä¸æ’å (Tables)
                     ========================================= */
  .table-container {
      width: 100%;
      overflow-x: auto;
      border-radius: 8px;
      margin-bottom: 1rem;
      -webkit-overflow-scrolling: touch;
  }

  .table-container::-webkit-scrollbar {
      height: 6px;
  }

  .table-container::-webkit-scrollbar-thumb {
      background: #ff5722;
      border-radius: 3px;
  }

  .table-container::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
  }

  .momentum-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 600px;
  }

  .momentum-table th,
  .momentum-table td {
      padding: 1rem;
      text-align: left;
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
      font-size: 0.95rem;
  }

  .momentum-table th {
      color: #ffffff;
      font-weight: bold;
      border-bottom: 2px solid rgba(255, 255, 255, 0.1);
      white-space: nowrap;
  }

  .momentum-table td {
      color: #b0c4de;
  }

  .active-row {
      background: rgba(255, 87, 34, 0.05);
  }

  .active-row td {
      color: #fff;
      font-weight: 700;
  }

  .rank-badge {
      display: inline-block;
      width: 24px;
      height: 24px;
      line-height: 24px;
      text-align: center;
      border-radius: 4px;
      background: rgba(255, 255, 255, 0.1);
      color: #aaa;
      font-size: 0.8rem;
      font-weight: bold;
  }

  .rank-1 {
      background: #ff5722;
      color: #fff;
  }

  .rank-2 {
      background: rgba(255, 160, 0, 0.8);
      color: #fff;
  }

  .rank-3 {
      background: rgba(255, 202, 40, 0.6);
      color: #fff;
  }

  .growth-col {
      font-family: 'Roboto Mono', monospace;
      font-weight: bold;
  }

  .code-col {
      font-family: 'Roboto Mono', monospace;
      opacity: 0.7;
  }

  .index-col {
      font-size: 0.9rem;
      color: #8392a5;
  }

  /* =========================================
                     6. å›¾è¡¨ä¸ç»Ÿè®¡ (Charts & Stats)
                     ========================================= */
  .echart-container {
      width: 100%;
      height: 350px;
      margin-top: 1rem;
  }

  .stats-bar {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      background: rgba(0, 0, 0, 0.2);
      margin-top: 1rem;
      padding: 1rem;
      border-radius: 8px;
      text-align: center;
      gap: 1rem;
  }

  .stat-label {
      color: #8392a5;
      font-size: 0.8rem;
      margin-bottom: 0.3rem;
  }

  .stat-value {
      font-size: 1.1rem;
      font-weight: bold;
      color: #fff;
  }

  .stat-value.highlight {
      color: #ff5722;
  }

  .stat-value.negative {
      color: #00c497;
  }

  /* =========================================
                     7. çƒ­åŠ›å›¾ (Heatmap)
                     ========================================= */
  .heatmap-table {
      width: 100%;
      border-collapse: collapse;
      table-layout: fixed;
      min-width: 800px;
  }

  .heatmap-table th {
      padding: 0.8rem 0.2rem;
      font-size: 0.85rem;
      color: #fff;
      border: 1px solid rgba(255, 255, 255, 0.1);
      white-space: nowrap;
  }

  .heatmap-table td {
      padding: 0.6rem 0.2rem;
      text-align: center;
      font-size: 0.85rem;
      border: 1px solid rgba(255, 255, 255, 0.1);
  }

  .year-col {
      font-weight: bold;
      background: rgba(255, 255, 255, 0.02);
  }

  .year-total {
      font-weight: bold;
      color: #fff;
  }

  /* =========================================
                     8. é£é™©åˆ†æ (Risk Analysis)
                     ========================================= */
  .risk-summary-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 1.5rem;
      margin-bottom: 2rem;
  }

  .risk-box {
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid rgba(255, 255, 255, 0.05);
      padding: 1.5rem 1rem;
      border-radius: 8px;
      text-align: center;
  }

  .risk-label {
      font-size: 0.85rem;
      color: #8392a5;
      margin-bottom: 0.5rem;
  }

  .risk-main-val {
      font-size: 1.4rem;
      font-weight: bold;
      color: #ff5722;
      margin-bottom: 0.3rem;
  }

  .risk-sub-val {
      font-size: 0.8rem;
      color: #b0c4de;
  }

  .dist-table-container {
      margin-bottom: 1.5rem;
  }

  .dist-table-inner {
      min-width: 600px;
  }

  .dist-header-row,
  .dist-bar-row,
  .dist-label-row {
      display: flex;
      width: 100%;
  }

  .dist-col {
      flex: 1;
      text-align: center;
      padding: 0.5rem;
      font-size: 0.8rem;
      color: #8392a5;
      border-right: 1px solid rgba(255, 255, 255, 0.05);
  }

  .dist-col:last-child {
      border-right: none;
  }

  .dist-bar-row {
      height: 40px;
      align-items: center;
      background: rgba(0, 0, 0, 0.2);
  }

  .dist-block.teal-theme {
      background: linear-gradient(145deg, #438a83, #24e3cd);
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
      color: #fff;
      font-weight: bold;
      padding: 0.3rem 0;
      border-radius: 4px;
      text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
  }

  .dist-header-row .dist-col {
      border-bottom: 1px solid rgba(255, 255, 255, 0.05);
      background: rgba(255, 255, 255, 0.02);
  }

  .sub-title {
      font-size: 1.1rem;
      color: #fff;
      margin-bottom: 1.2rem;
      font-weight: bold;
  }

  .risk-table {
      width: 100%;
      border-collapse: collapse;
      min-width: 700px;
  }

  .risk-table th {
      background: rgba(0, 0, 0, 0.2);
      color: #fff;
      font-weight: bold;
      padding: 0.8rem;
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.1);
      white-space: nowrap;
  }

  .risk-table td {
      border: 1px solid rgba(255, 255, 255, 0.1);
      padding: 0.8rem;
      text-align: center;
      color: #b0c4de;
      font-size: 0.9rem;
      white-space: nowrap;
  }

  /* =========================================
                     9. FAQ ä¸ è¾…åŠ©æ ·å¼
                     ========================================= */
  .faq-container {
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
  }

  .faq-item {
      border-bottom: 1px solid rgba(255, 255, 255, 0.1);
  }

  .faq-item:last-child {
      border-bottom: none;
  }

  .faq-question {
      width: 100%;
      text-align: left;
      padding: 1rem 0;
      background: none;
      border: none;
      color: #fff;
      font-size: 1rem;
      cursor: pointer;
      display: flex;
      justify-content: space-between;
      align-items: center;
  }

  .faq-icon {
      font-size: 1.5rem;
      font-weight: bold;
      transition: transform 0.3s ease;
      color: #ff5722;
  }

  .faq-icon.is-open {
      transform: rotate(45deg);
  }

  .faq-answer {
      padding-bottom: 1rem;
      color: #b0c4de;
      line-height: 1.7;
  }

  .text-red {
      color: #ff5722 !important;
  }

  .text-green {
      color: #00c497 !important;
  }

  /* =========================================
                     10. ç§»åŠ¨ç«¯/å“åº”å¼é€‚é… (Responsive)
                     ========================================= */

  /* å¹³æ¿ (<= 992px) */
  @media (max-width: 992px) {
      .page-wrapper {
          padding: 2.5rem 1.5rem;
      }
  }

  /* æ‰‹æœº (<= 768px) */
  @media (max-width: 768px) {
      .table-container {
          mask-image: linear-gradient(to right, transparent, black 15px, black 95%, transparent);
          -webkit-mask-image: linear-gradient(
              to right,
              transparent,
              black 15px,
              black 95%,
              transparent
          );
      }

      .page-wrapper {
          padding: 2rem 1rem;
          width: 100%;
          box-sizing: border-box;
      }

      .main-container {
          width: 100%;
      }

      /* å¤´éƒ¨é€‚é… */
      .page-header {
          margin-bottom: 2rem;
      }

      .main-title {
          font-size: 2rem;
          gap: 0.8rem;
      }

      .subtitle {
          font-size: 0.95rem;
      }

      /* å¡ç‰‡é—´è· */
      .content-card {
          padding: 1.25rem 1rem;
      }

      /* --- æ ¸å¿ƒä¿®å¤ï¼šç›‘æ§å¤´éƒ¨ç§»åŠ¨ç«¯é€‚é… --- */
      .monitor-header {
          align-items: flex-start;
      }

      .monitor-meta {
          width: 100%; /* å æ»¡æ•´è¡Œ */
          justify-content: space-between; /* æ—¶é—´åœ¨å·¦ï¼Œæ ‡ç­¾åœ¨å³ */
          padding-top: 0.5rem;
          border-top: 1px solid rgba(255, 255, 255, 0.05); /* æ·¡æ·¡çš„åˆ†éš”çº¿ï¼Œç¾è§‚ */
      }

      .signal-time {
          font-size: 0.75rem;
      }

      /* åŠ¨é‡ç›‘æ§å•åˆ—å¸ƒå±€ */
      .dashboard-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
      }

      /* å®æ—¶æ•°æ®å¤´éƒ¨ä¸¤è¡Œæ˜¾ç¤º */
      .data-section-header {
          flex-direction: column;
          align-items: flex-start;
      }

      .system-status {
          width: 100%;
          justify-content: center;
          margin-top: 0.2rem;
      }

      /* ç»Ÿè®¡æ¡æ”¹ä¸º 2x2 */
      .stats-bar {
          grid-template-columns: repeat(2, 1fr);
          padding: 0.8rem;
      }

      /* é£é™©æ•°æ®å•åˆ— */
      .risk-summary-grid {
          grid-template-columns: 1fr;
          gap: 1rem;
      }

      .risk-box {
          padding: 1.2rem;
          display: flex;
          flex-direction: column;
          align-items: center;
      }

      .faq-question {
          font-size: 0.95rem;
      }

      .momentum-table,
      .heatmap-table,
      .risk-table,
      .dist-table-inner {
          font-size: 0.85rem;
      }
  }
</style>